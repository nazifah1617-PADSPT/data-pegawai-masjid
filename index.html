<!doctype html>
<html lang="ms">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistem Maklumat Kariah &amp; Masjid</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>
  <script src="https://unpkg.com/jspdf-autotable@latest/dist/jspdf.plugin.autotable.min.js"></script>
  <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap');
        body { 
            font-family: 'Poppins', sans-serif; 
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #cbd5e1 100%);
            background-attachment: fixed;
            min-height: 100vh;
            box-sizing: border-box;
        }
        .gradient-bg { 
            background: linear-gradient(135deg, #1e293b 0%, #334155 50%, #475569 100%); 
            position: relative;
            overflow: hidden;
        }
        .gradient-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1.5" fill="white" opacity="0.15"/><circle cx="75" cy="75" r="1.5" fill="white" opacity="0.15"/><circle cx="50" cy="10" r="1" fill="white" opacity="0.1"/><circle cx="10" cy="60" r="1" fill="white" opacity="0.1"/><circle cx="90" cy="40" r="1" fill="white" opacity="0.1"/><circle cx="30" cy="80" r="0.5" fill="white" opacity="0.2"/><circle cx="70" cy="20" r="0.5" fill="white" opacity="0.2"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
        }
        .card-hover { 
            position: relative;
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .search-input { 
            transition: all 0.4s ease; 
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }
        .search-input:focus { 
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2), 0 8px 25px rgba(0,0,0,0.1); 
            background: rgba(255, 255, 255, 1);
        }
        .btn-primary {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            box-shadow: 0 8px 25px rgba(30, 41, 59, 0.3);
            border: none;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        .btn-primary:hover::before {
            left: 100%;
        }
        .btn-primary:hover {
            box-shadow: 0 15px 35px rgba(30, 41, 59, 0.4);
            transform: translateY(-2px);
        }
        .btn-secondary {
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
            box-shadow: 0 8px 25px rgba(100, 116, 139, 0.3);
            transition: all 0.3s ease;
        }
        .btn-secondary:hover {
            box-shadow: 0 15px 35px rgba(100, 116, 139, 0.4);
            transform: translateY(-2px);
        }
        .btn-success {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            box-shadow: 0 8px 25px rgba(5, 150, 105, 0.3);
            transition: all 0.3s ease;
        }
        .btn-success:hover {
            box-shadow: 0 15px 35px rgba(5, 150, 105, 0.4);
            transform: translateY(-2px);
        }
        .btn-purple {
            background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
            color: white !important;
            box-shadow: 0 8px 25px rgba(124, 58, 237, 0.3);
            transition: all 0.3s ease;
        }
        .btn-purple:hover {
            box-shadow: 0 15px 35px rgba(124, 58, 237, 0.4);
            transform: translateY(-2px);
        }
        .btn-danger {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            box-shadow: 0 8px 25px rgba(220, 38, 38, 0.3);
            transition: all 0.3s ease;
        }
        .btn-danger:hover {
            box-shadow: 0 15px 35px rgba(220, 38, 38, 0.4);
            transform: translateY(-2px);
        }
        .mosque-icon {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .fade-in {
            animation: fadeIn 0.6s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .table-row:hover {
            background: rgba(59, 130, 246, 0.05);
        }
        .modal-backdrop {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body><!-- Header -->
  <header class="gradient-bg text-white shadow-2xl relative z-10">
   <div class="container mx-auto px-6 py-8">
    <div class="flex items-center justify-between">
     <div class="flex items-center space-x-4">
      <div class="text-4xl mosque-icon">
       🕌
      </div>
      <div>
       <h1 class="text-3xl font-bold">Sistem Maklumat Pegawai Masjid</h1>
       <p class="text-slate-300 text-sm">Pengurusan Pegawai Imam, Bilal &amp; Siak</p>
      </div>
     </div>
     <div class="text-right">
      <p class="text-sm text-slate-300">Tarikh: <span id="currentDate"></span></p>
      <p class="text-sm text-slate-300">Masa: <span id="currentTime"></span></p>
     </div>
    </div>
   </div>
  </header><!-- Main Content -->
  <main class="container mx-auto px-6 py-8"><!-- Global Search -->
   <div class="mb-6">
    <div class="card-hover rounded-2xl p-6 shadow-xl">
     <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center"><span class="text-2xl mr-3">🔍</span> Carian Pegawai Masjid</h2>
     <div class="flex gap-4">
      <div class="flex-1"><input type="text" id="globalSearch" placeholder="🔍 Cari menggunakan nama atau no. K/P..." class="search-input w-full px-4 py-3 border border-gray-300 rounded-xl">
      </div><button onclick="performGlobalSearch()" class="btn-primary text-white px-6 py-3 rounded-xl font-medium"> 🔍 Cari </button> <button onclick="clearGlobalSearch()" class="btn-secondary text-white px-6 py-3 rounded-xl font-medium"> 🗑️ Kosongkan </button>
     </div>
     <div id="globalSearchResults" class="mt-4 hidden">
      <div class="flex justify-between items-center mb-3">
       <h3 class="text-lg font-semibold text-gray-800">Keputusan Carian:</h3><button onclick="exportSearchResultsToPDF()" id="exportSearchBtn" class="btn-purple text-white px-4 py-2 rounded-lg font-medium text-sm hidden"> 📄 Cetak PDF Hasil Carian </button>
      </div>
      <div id="searchResultsContent" class="space-y-3"></div>
     </div>
    </div>
   </div><!-- Navigation Tabs -->
   <div class="mb-8">
    <div class="flex flex-wrap gap-2 bg-white/80 backdrop-blur-sm p-2 rounded-2xl shadow-lg"><button onclick="showTab('imam')" id="tab-imam" class="tab-btn btn-primary text-white px-6 py-3 rounded-xl font-medium transition-all"> 🕌 Imam </button> <button onclick="showTab('bilal')" id="tab-bilal" class="tab-btn bg-gray-200 text-gray-700 px-6 py-3 rounded-xl font-medium transition-all hover:bg-gray-300"> 📢 Bilal </button> <button onclick="showTab('siak')" id="tab-siak" class="tab-btn bg-gray-200 text-gray-700 px-6 py-3 rounded-xl font-medium transition-all hover:bg-gray-300"> 📋 Siak </button> <button onclick="showTab('laporan')" id="tab-laporan" class="tab-btn bg-gray-200 text-gray-700 px-6 py-3 rounded-xl font-medium transition-all hover:bg-gray-300"> 📊 Laporan </button> <button onclick="showTab('peletakan')" id="tab-peletakan" class="tab-btn bg-gray-200 text-gray-700 px-6 py-3 rounded-xl font-medium transition-all hover:bg-gray-300"> 📍 Laporan Perletakan Pegawai Masjid </button>
    </div>
   </div><!-- Imam Tab -->
   <div id="imam-tab" class="tab-content fade-in"><!-- Control Buttons -->
    <div class="mb-6 flex gap-4"><button onclick="loadImamDataFromSheet()" class="btn-primary text-white px-6 py-3 rounded-xl font-medium"> 🔄 Muat Semula Data Imam </button> <button onclick="toggleImamList()" id="toggleImamListBtn" class="btn-secondary text-white px-6 py-3 rounded-xl font-medium"> 📋 Lihat Senarai Imam </button>
    </div>
    <div class="grid lg:grid-cols-1 gap-8"><!-- Senarai Imam -->
     <div id="imamListSection" class="lg:col-span-1 hidden">
      <div class="card-hover rounded-2xl p-6 shadow-xl">
       <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-gray-800 flex items-center"><span class="text-2xl mr-3">🕌</span> Senarai Imam</h2>
        <div class="flex gap-2"><button onclick="exportToPDF('imam')" class="btn-purple text-white px-4 py-2 rounded-lg font-medium text-sm"> 📄 Export PDF </button> <button onclick="clearAllData('imam')" class="btn-danger text-white px-4 py-2 rounded-lg font-medium text-sm"> 🗑️ Kosongkan </button>
        </div>
       </div>
       <div class="mb-4"><input type="text" id="searchImam" placeholder="🔍 Cari imam..." class="search-input w-full px-4 py-3 border border-gray-300 rounded-xl">
       </div>
       <div class="overflow-x-auto">
        <table class="w-full">
         <thead>
          <tr class="bg-gray-50 border-b">
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Masjid</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Daerah</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Nama Imam</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">No. K/P</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Pekerjaan</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Alamat</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">No. Tel</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Umur</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Mula Khidmat</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Catatan</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Tindakan</th>
          </tr>
         </thead>
         <tbody id="imamList">
          <tr>
           <td colspan="10" class="text-center py-8 text-gray-500">
            <div class="text-4xl mb-2">
             🕌
            </div> Tiada imam didaftarkan lagi</td>
          </tr>
         </tbody>
        </table>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Bilal Tab -->
   <div id="bilal-tab" class="tab-content hidden"><!-- Control Buttons -->
    <div class="mb-6 flex gap-4"><button onclick="loadBilalDataFromSheet()" class="btn-primary text-white px-6 py-3 rounded-xl font-medium"> 🔄 Muat Semula Data Bilal </button> <button onclick="toggleBilalList()" id="toggleBilalListBtn" class="btn-secondary text-white px-6 py-3 rounded-xl font-medium"> 📋 Lihat Senarai Bilal </button>
    </div>
    <div class="grid lg:grid-cols-1 gap-8"><!-- Senarai Bilal -->
     <div id="bilalListSection" class="lg:col-span-1 hidden">
      <div class="card-hover rounded-2xl p-6 shadow-xl">
       <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-gray-800 flex items-center"><span class="text-2xl mr-3">📢</span> Senarai Bilal</h2>
        <div class="flex gap-2"><button onclick="exportToPDF('bilal')" class="btn-purple text-white px-4 py-2 rounded-lg font-medium text-sm"> 📄 Export PDF </button> <button onclick="clearAllData('bilal')" class="btn-danger text-white px-4 py-2 rounded-lg font-medium text-sm"> 🗑️ Kosongkan </button>
        </div>
       </div>
       <div class="mb-4"><input type="text" id="searchBilal" placeholder="🔍 Cari bilal..." class="search-input w-full px-4 py-3 border border-gray-300 rounded-xl">
       </div>
       <div class="overflow-x-auto">
        <table class="w-full">
         <thead>
          <tr class="bg-gray-50 border-b">
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Masjid</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Daerah</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Nama Bilal</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">No. K/P</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Pekerjaan</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Alamat</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">No. Tel</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Umur</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Mula Khidmat</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Catatan</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Tindakan</th>
          </tr>
         </thead>
         <tbody id="bilalList">
          <tr>
           <td colspan="10" class="text-center py-8 text-gray-500">
            <div class="text-4xl mb-2">
             📢
            </div> Tiada bilal didaftarkan lagi</td>
          </tr>
         </tbody>
        </table>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Siak Tab -->
   <div id="siak-tab" class="tab-content hidden"><!-- Control Buttons -->
    <div class="mb-6 flex gap-4"><button onclick="toggleSiakForm()" id="toggleSiakFormBtn" class="btn-purple text-white px-6 py-3 rounded-xl font-medium"> ➕ Daftar Siak Baru </button> <button onclick="toggleSiakList()" id="toggleSiakListBtn" class="btn-secondary text-white px-6 py-3 rounded-xl font-medium"> 📋 Lihat Senarai Siak </button>
    </div>
    <div class="grid lg:grid-cols-3 gap-8"><!-- Form Siak -->
     <div id="siakFormSection" class="lg:col-span-1 hidden">
      <div class="card-hover rounded-2xl p-6 shadow-xl">
       <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center"><span class="text-2xl mr-3">📋</span> Daftar Siak</h2>
       <form id="siakForm" class="space-y-4">
        <div><label class="block text-sm font-medium text-gray-700 mb-2">Nama Siak</label> <input type="text" id="namaSiak" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
        </div>
        <div><label class="block text-sm font-medium text-gray-700 mb-2">No. K/P</label> <input type="text" id="nokpSiak" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
        </div>
        <div><label class="block text-sm font-medium text-gray-700 mb-2">No. Gaji</label> <input type="text" id="noGajiSiak" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Contoh: G001234">
        </div>
        <div><label class="block text-sm font-medium text-gray-700 mb-2">No. Akaun BSN</label> <input type="text" id="noAkaunSiak" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Contoh: 1234567890">
        </div>
        <div><label class="block text-sm font-medium text-gray-700 mb-2">Pekerjaan</label> <input type="text" id="pekerjaanSiak" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Contoh: Guru Agama">
        </div>
        <div><label class="block text-sm font-medium text-gray-700 mb-2">Alamat</label> <textarea id="alamatSiak" required rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"></textarea>
        </div>
        <div><label class="block text-sm font-medium text-gray-700 mb-2">No. Tel</label> <input type="tel" id="telefonSiak" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
        </div>
        <div><label class="block text-sm font-medium text-gray-700 mb-2">Masjid</label> <input type="text" id="masjidSiak" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Contoh: Masjid Al-Hidayah">
        </div>
        <div><label class="block text-sm font-medium text-gray-700 mb-2">Daerah</label> <input type="text" id="daerahSiak" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Contoh: Kuala Lumpur">
        </div>
        <div><label class="block text-sm font-medium text-gray-700 mb-2">Mula Khidmat</label> <input type="date" id="mulaKhidmatSiak" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
        </div><button type="submit" class="w-full btn-purple text-white py-3 px-6 rounded-xl font-medium"> ✅ Daftar Siak </button>
       </form>
      </div>
     </div><!-- Senarai Siak -->
     <div id="siakListSection" class="lg:col-span-3 hidden">
      <div class="card-hover rounded-2xl p-6 shadow-xl">
       <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-gray-800 flex items-center"><span class="text-2xl mr-3">📋</span> Senarai Siak</h2>
        <div class="flex gap-2"><button onclick="exportToPDF('siak')" class="btn-purple text-white px-4 py-2 rounded-lg font-medium text-sm"> 📄 Export PDF </button> <button onclick="clearAllData('siak')" class="btn-danger text-white px-4 py-2 rounded-lg font-medium text-sm"> 🗑️ Kosongkan </button>
        </div>
       </div>
       <div class="mb-4"><input type="text" id="searchSiak" placeholder="🔍 Cari siak..." class="search-input w-full px-4 py-3 border border-gray-300 rounded-xl">
       </div>
       <div class="overflow-x-auto">
        <table class="w-full">
         <thead>
          <tr class="bg-gray-50 border-b">
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Bil</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Nama Siak</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">No. K/P</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">No. Gaji</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">No. Akaun BSN</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Pekerjaan</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Alamat</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">No. Tel</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Masjid</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Daerah</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Mula Khidmat</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Tindakan</th>
          </tr>
         </thead>
         <tbody id="siakList">
          <tr>
           <td colspan="10" class="text-center py-8 text-gray-500">
            <div class="text-4xl mb-2">
             📋
            </div> Tiada siak didaftarkan lagi</td>
          </tr>
         </tbody>
        </table>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Laporan Perletakan Pegawai Masjid Tab -->
   <div id="peletakan-tab" class="tab-content hidden">
    <div class="grid lg:grid-cols-3 gap-8"><!-- Form Peletakan Imam -->
     <div class="lg:col-span-1">
      <div class="card-hover rounded-2xl p-6 shadow-xl">
       <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center"><span class="text-2xl mr-3">🕌</span> Perletakan Jawatan Imam</h2>
       <form id="peletakanImamForm" class="space-y-4">
        <div><label class="block text-sm font-medium text-gray-700 mb-2">Pilih Imam</label> <select id="pilihImam" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"> <option value="">Pilih Imam</option> </select>
        </div>
        <div><label class="block text-sm font-medium text-gray-700 mb-2">Catatan</label> <textarea id="catatanImam" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Masukkan catatan tambahan (pilihan)"></textarea>
        </div><button type="submit" class="w-full btn-primary text-white py-3 px-6 rounded-xl font-medium"> ✅ Tetapkan Perletakan </button>
       </form>
      </div><!-- Form Peletakan Bilal -->
      <div class="card-hover rounded-2xl p-6 shadow-xl mt-6">
       <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center"><span class="text-2xl mr-3">📢</span> Perletakan Jawatan Bilal</h2>
       <form id="peletakanBilalForm" class="space-y-4">
        <div><label class="block text-sm font-medium text-gray-700 mb-2">Pilih Bilal</label> <select id="pilihBilal" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"> <option value="">Pilih Bilal</option> </select>
        </div>
        <div><label class="block text-sm font-medium text-gray-700 mb-2">Catatan</label> <textarea id="catatanBilal" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Masukkan catatan tambahan (pilihan)"></textarea>
        </div><button type="submit" class="w-full btn-success text-white py-3 px-6 rounded-xl font-medium"> ✅ Tetapkan Perletakan </button>
       </form>
      </div><!-- Form Peletakan Siak -->
      <div class="card-hover rounded-2xl p-6 shadow-xl mt-6">
       <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center"><span class="text-2xl mr-3">📋</span> Perletakan Jawatan Siak</h2>
       <form id="peletakanSiakForm" class="space-y-4">
        <div><label class="block text-sm font-medium text-gray-700 mb-2">Pilih Siak</label> <select id="pilihSiak" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"> <option value="">Pilih Siak</option> </select>
        </div>
        <div><label class="block text-sm font-medium text-gray-700 mb-2">Catatan</label> <textarea id="catatanSiak" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Masukkan catatan tambahan (pilihan)"></textarea>
        </div><button type="submit" class="w-full btn-purple text-white py-3 px-6 rounded-xl font-medium"> ✅ Tetapkan Perletakan </button>
       </form>
      </div>
     </div><!-- Senarai Peletakan -->
     <div class="lg:col-span-2">
      <div class="card-hover rounded-2xl p-6 shadow-xl">
       <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-gray-800 flex items-center"><span class="text-2xl mr-3">📍</span> Senarai Perletakan Pegawai</h2>
        <div class="flex gap-2"><button onclick="exportPeletakanToPDF()" class="btn-purple text-white px-4 py-2 rounded-lg font-medium text-sm"> 📄 Export PDF </button> <button onclick="clearAllPeletakan()" class="btn-danger text-white px-4 py-2 rounded-lg font-medium text-sm"> 🗑️ Kosongkan </button>
        </div>
       </div>
       <div class="mb-4"><input type="text" id="searchPeletakan" placeholder="🔍 Cari perletakan..." class="search-input w-full px-4 py-3 border border-gray-300 rounded-xl">
       </div>
       <div class="overflow-x-auto">
        <table class="w-full">
         <thead>
          <tr class="bg-gray-50 border-b">
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Bil</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Nama</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Jenis</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Perletakan</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Jadual/Bidang</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Masjid</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Catatan</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Tindakan</th>
          </tr>
         </thead>
         <tbody id="peletakanList">
          <tr>
           <td colspan="8" class="text-center py-8 text-gray-500">
            <div class="text-4xl mb-2">
             📍
            </div> Tiada perletakan ditetapkan lagi</td>
          </tr>
         </tbody>
        </table>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Laporan Tab -->
   <div id="laporan-tab" class="tab-content hidden">
    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"><!-- Statistik Cards -->
     <div class="card-hover rounded-2xl p-6 shadow-xl text-center">
      <div class="text-4xl mb-3">
       🕌
      </div>
      <h3 class="text-lg font-bold text-gray-800">Jumlah Imam</h3>
      <p class="text-3xl font-bold text-blue-600" id="totalImam">0</p>
     </div>
     <div class="card-hover rounded-2xl p-6 shadow-xl text-center">
      <div class="text-4xl mb-3">
       📢
      </div>
      <h3 class="text-lg font-bold text-gray-800">Jumlah Bilal</h3>
      <p class="text-3xl font-bold text-green-600" id="totalBilal">0</p>
     </div>
     <div class="card-hover rounded-2xl p-6 shadow-xl text-center">
      <div class="text-4xl mb-3">
       📋
      </div>
      <h3 class="text-lg font-bold text-gray-800">Jumlah Siak</h3>
      <p class="text-3xl font-bold text-purple-600" id="totalSiak">0</p>
     </div>
     <div class="card-hover rounded-2xl p-6 shadow-xl text-center">
      <div class="text-4xl mb-3">
       📍
      </div>
      <h3 class="text-lg font-bold text-gray-800">Jumlah Perletakan</h3>
      <p class="text-3xl font-bold text-orange-600" id="totalPeletakan">0</p>
     </div>
    </div><!-- Laporan Terperinci -->
    <div class="card-hover rounded-2xl p-6 shadow-xl">
     <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center"><span class="text-2xl mr-3">📈</span> Laporan Terperinci</h2>
     <div class="grid md:grid-cols-3 gap-6"><button onclick="generateReport('imam')" class="btn-primary text-white p-6 rounded-xl text-center">
       <div class="text-3xl mb-2">
        🕌
       </div><h3 class="font-bold">Laporan Imam</h3><p class="text-sm opacity-90">Senarai lengkap imam masjid</p></button> <button onclick="generateReport('bilal')" class="btn-success text-white p-6 rounded-xl text-center">
       <div class="text-3xl mb-2">
        📢
       </div><h3 class="font-bold">Laporan Bilal</h3><p class="text-sm opacity-90">Senarai lengkap bilal masjid</p></button> <button onclick="generateReport('siak')" class="btn-purple text-white p-6 rounded-xl text-center">
       <div class="text-3xl mb-2">
        📋
       </div><h3 class="font-bold">Laporan Siak</h3><p class="text-sm opacity-90">Senarai lengkap siak masjid</p></button>
     </div>
    </div>
   </div>
  </main><!-- Modal untuk Edit -->
  <div id="editModal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50">
   <div class="bg-white rounded-2xl p-6 max-w-md w-full mx-4 shadow-2xl">
    <h3 class="text-xl font-bold mb-4" id="modalTitle">Edit Data</h3>
    <div id="modalContent"></div>
    <div class="flex gap-3 mt-6"><button onclick="closeModal()" class="flex-1 btn-secondary text-white py-2 px-4 rounded-lg"> Batal </button> <button onclick="saveEdit()" class="flex-1 btn-primary text-white py-2 px-4 rounded-lg"> Simpan </button>
    </div>
   </div>
  </div><!-- Modal untuk PDF Preview -->
  <div id="pdfPreviewModal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50">
   <div class="bg-white rounded-2xl p-6 max-w-6xl w-full mx-4 shadow-2xl" style="height: 90vh;">
    <div class="flex justify-between items-center mb-4">
     <h3 class="text-xl font-bold" id="pdfModalTitle">Pratonton Laporan PDF</h3><button onclick="closePDFModal()" class="text-gray-500 hover:text-gray-700 text-2xl"> ✕ </button>
    </div>
    <div class="mb-4 flex gap-3"><button onclick="downloadCurrentPDF()" class="btn-primary text-white px-6 py-2 rounded-lg font-medium"> 📥 Muat Turun PDF </button> <button onclick="printCurrentPDF()" class="btn-success text-white px-6 py-2 rounded-lg font-medium"> 🖨️ Cetak PDF </button> <button onclick="closePDFModal()" class="btn-secondary text-white px-6 py-2 rounded-lg font-medium"> ❌ Tutup </button>
    </div>
    <div class="border border-gray-300 rounded-lg overflow-hidden" style="height: calc(100% - 120px);"><iframe id="pdfViewer" class="w-full h-full" frameborder="0"></iframe>
    </div>
   </div>
  </div>
  <script>
        // Data storage
        let imamData = []; // Will be loaded from Google Sheets
        let bilalData = []; // Will be loaded from Google Sheets
        let siakData = JSON.parse(localStorage.getItem('siakData')) || [];
        let peletakanData = JSON.parse(localStorage.getItem('peletakanData')) || [];
        let currentEditType = '';
        let currentEditIndex = -1;

        // Google Sheets CSV URLs
        const IMAM_SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTMdVbauPNjDdm5PjpJ9757hQAjohDd0rtXxHUfzFOZwbVovFSD6P8x41wsjfzxjw/pub?gid=1151842269&single=true&output=csv';
        const BILAL_SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTMdVbauPNjDdm5PjpJ9757hQAjohDd0rtXxHUfzFOZwbVovFSD6P8x41wsjfzxjw/pub?gid=668558288&single=true&output=csv';

        // Function to calculate age from Malaysian IC number
        function calculateAgeFromIC(nokp) {
            if (!nokp || nokp.length < 6) return '-';
            
            try {
                // Extract birth date from IC (first 6 digits: YYMMDD)
                const yearDigits = nokp.substring(0, 2);
                const month = nokp.substring(2, 4);
                const day = nokp.substring(4, 6);
                
                // Determine century (if year > 30, assume 19xx, else 20xx)
                const year = parseInt(yearDigits) > 30 ? `19${yearDigits}` : `20${yearDigits}`;
                
                // Create birth date
                const birthDate = new Date(`${year}-${month}-${day}`);
                const today = new Date();
                
                // Calculate age
                let age = today.getFullYear() - birthDate.getFullYear();
                const monthDiff = today.getMonth() - birthDate.getMonth();
                
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }
                
                return age > 0 && age < 150 ? age : '-';
            } catch (error) {
                return '-';
            }
        }

        // Function to load Imam data from Google Sheets
        async function loadImamDataFromSheet() {
            try {
                const response = await fetch(IMAM_SHEET_URL);
                const csvText = await response.text();
                
                // Parse CSV data
                const lines = csvText.split('\n');
                const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
                
                imamData = [];
                
                for (let i = 1; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (line) {
                        const values = parseCSVLine(line);
                        if (values.length >= 11) { // Ensure we have at least 11 columns (A-K)
                            const nokp = values[4] || ''; // Column E: NO. K/P
                            const calculatedAge = calculateAgeFromIC(nokp);
                            
                            const imam = {
                                id: Date.now() + i,
                                bil: values[0] || (i), // Column A: BIL (hidden from display)
                                masjid: values[1] || '', // Column B: MASJID
                                daerah: values[2] || '', // Column C: DAERAH
                                nama: values[3] || '', // Column D: NAMA IMAM
                                nokp: nokp, // Column E: NO. K/P
                                pekerjaan: values[5] || '', // Column F: PEKERJAAN
                                alamat: values[6] || '', // Column G: ALAMAT
                                telefon: values[7] || '', // Column H: NO.TEL
                                umur: values[8] || calculatedAge, // Column I: UMUR (use sheet value or calculated)
                                mulaKhidmat: values[9] || new Date().toISOString().split('T')[0], // Column J: MULA KHIDMAT
                                catatan: values[10] || '' // Column K: CATATAN
                            };
                            imamData.push(imam);
                        }
                    }
                }
                
                displayImam();
                updateStatistics();
                updatePeletakanDropdowns();
                
                console.log(`✅ Berjaya memuat ${imamData.length} data imam dari Google Sheets`);
                
            } catch (error) {
                console.error('❌ Ralat memuat data imam:', error);
                // Show user-friendly error message
                const tbody = document.getElementById('imamList');
                tbody.innerHTML = `
                    <tr>
                        <td colspan="10" class="text-center py-8 text-red-500">
                            <div class="text-4xl mb-2">⚠️</div>
                            <p class="font-semibold">Ralat memuat data imam dari Google Sheets</p>
                            <p class="text-sm mt-2">Sila semak sambungan internet dan cuba lagi</p>
                            <button onclick="loadImamDataFromSheet()" class="mt-3 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">
                                🔄 Cuba Lagi
                            </button>
                        </td>
                    </tr>
                `;
            }
        }

        // Function to load Bilal data from Google Sheets
        async function loadBilalDataFromSheet() {
            try {
                const response = await fetch(BILAL_SHEET_URL);
                const csvText = await response.text();
                
                // Parse CSV data
                const lines = csvText.split('\n');
                const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
                
                bilalData = [];
                
                for (let i = 1; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (line) {
                        const values = parseCSVLine(line);
                        if (values.length >= 11) { // Ensure we have at least 11 columns (A-K)
                            const nokp = values[4] || ''; // Column E: NO. K/P
                            const calculatedAge = calculateAgeFromIC(nokp);
                            
                            const bilal = {
                                id: Date.now() + i,
                                bil: values[0] || (i), // Column A: BIL (hidden from display)
                                masjid: values[1] || '', // Column B: MASJID
                                daerah: values[2] || '', // Column C: DAERAH
                                nama: values[3] || '', // Column D: NAMA BILAL
                                nokp: nokp, // Column E: NO. K/P
                                pekerjaan: values[5] || '', // Column F: PEKERJAAN
                                alamat: values[6] || '', // Column G: ALAMAT
                                telefon: values[7] || '', // Column H: NO.TEL
                                umur: values[8] || calculatedAge, // Column I: UMUR (use sheet value or calculated)
                                mulaKhidmat: values[9] || new Date().toISOString().split('T')[0], // Column J: MULA KHIDMAT
                                catatan: values[10] || '' // Column K: CATATAN
                            };
                            bilalData.push(bilal);
                        }
                    }
                }
                
                displayBilal();
                updateStatistics();
                updatePeletakanDropdowns();
                
                console.log(`✅ Berjaya memuat ${bilalData.length} data bilal dari Google Sheets`);
                
            } catch (error) {
                console.error('❌ Ralat memuat data bilal:', error);
                // Show user-friendly error message
                const tbody = document.getElementById('bilalList');
                tbody.innerHTML = `
                    <tr>
                        <td colspan="10" class="text-center py-8 text-red-500">
                            <div class="text-4xl mb-2">⚠️</div>
                            <p class="font-semibold">Ralat memuat data bilal dari Google Sheets</p>
                            <p class="text-sm mt-2">Sila semak sambungan internet dan cuba lagi</p>
                            <button onclick="loadBilalDataFromSheet()" class="mt-3 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">
                                🔄 Cuba Lagi
                            </button>
                        </td>
                    </tr>
                `;
            }
        }

        // Function to parse CSV line properly (handles commas within quotes)
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim().replace(/"/g, ''));
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(current.trim().replace(/"/g, ''));
            return result;
        }



        // Update date and time
        function updateDateTime() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('ms-MY', options);
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('ms-MY');
        }

        // Tab functionality
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.remove('hidden');
            
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('btn-primary', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            document.getElementById('tab-' + tabName).classList.remove('bg-gray-200', 'text-gray-700');
            document.getElementById('tab-' + tabName).classList.add('btn-primary', 'text-white');
        }
        
        // Initialize with laporan tab as default
        document.addEventListener('DOMContentLoaded', function() {
            // Show laporan tab by default instead of imam
            showTab('laporan');
            
            // Rest of initialization code...
            updateDateTime();
            setInterval(updateDateTime, 1000);
            
            // Load data from Google Sheets in background
            loadImamDataFromSheet();
            loadBilalDataFromSheet();
            
            displaySiak();
            displayPeletakan();
            updateStatistics();
            updatePeletakanDropdowns();
            
            // Set default date to today for other forms
            document.getElementById('mulaKhidmatSiak').value = new Date().toISOString().split('T')[0];
            
            // Search functionality
            document.getElementById('searchImam').addEventListener('input', () => searchTable('imam'));
            document.getElementById('searchBilal').addEventListener('input', () => searchTable('bilal'));
            document.getElementById('searchSiak').addEventListener('input', () => searchTable('siak'));
            document.getElementById('searchPeletakan').addEventListener('input', () => searchTable('peletakan'));
            
            // Global search functionality
            document.getElementById('globalSearch').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    performGlobalSearch();
                }
            });
        });

        // Load data on page load
        // Note: Imam and Bilal forms have been removed as data comes from Google Sheets

        // Siak form submission
        document.getElementById('siakForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const siak = {
                id: Date.now(),
                nama: document.getElementById('namaSiak').value,
                nokp: document.getElementById('nokpSiak').value,
                noGaji: document.getElementById('noGajiSiak').value,
                noAkaun: document.getElementById('noAkaunSiak').value,
                pekerjaan: document.getElementById('pekerjaanSiak').value,
                alamat: document.getElementById('alamatSiak').value,
                telefon: document.getElementById('telefonSiak').value,
                masjid: document.getElementById('masjidSiak').value,
                daerah: document.getElementById('daerahSiak').value,
                mulaKhidmat: document.getElementById('mulaKhidmatSiak').value
            };
            
            siakData.push(siak);
            localStorage.setItem('siakData', JSON.stringify(siakData));
            
            this.reset();
            document.getElementById('mulaKhidmatSiak').value = new Date().toISOString().split('T')[0];
            displaySiak();
            updateStatistics();
            updatePeletakanDropdowns();
            
            alert('✅ Siak berjaya didaftarkan!');
        });

        // Display imam
        function displayImam() {
            const tbody = document.getElementById('imamList');
            
            if (imamData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="11" class="text-center py-8 text-gray-500">
                            <div class="text-4xl mb-2">🕌</div>
                            Tiada imam didaftarkan lagi
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = imamData.map((imam, index) => `
                <tr class="table-row border-b hover:bg-blue-50 transition-colors">
                    <td class="py-3 px-4">${imam.masjid}</td>
                    <td class="py-3 px-4">${imam.daerah}</td>
                    <td class="py-3 px-4 font-medium">${imam.nama}</td>
                    <td class="py-3 px-4">${imam.nokp}</td>
                    <td class="py-3 px-4">${imam.pekerjaan}</td>
                    <td class="py-3 px-4">${imam.alamat}</td>
                    <td class="py-3 px-4">${imam.telefon}</td>
                    <td class="py-3 px-4">${imam.umur}</td>
                    <td class="py-3 px-4">${new Date(imam.mulaKhidmat).toLocaleDateString('ms-MY')}</td>
                    <td class="py-3 px-4">${imam.catatan || '-'}</td>
                    <td class="py-3 px-4">
                        <div class="flex gap-2">
                            <button onclick="editItem('imam', ${index})" class="text-blue-600 hover:text-blue-800 text-sm">
                                ✏️ Edit
                            </button>
                            <button onclick="deleteItem('imam', ${index})" class="text-red-600 hover:text-red-800 text-sm">
                                🗑️ Hapus
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Display bilal
        function displayBilal() {
            const tbody = document.getElementById('bilalList');
            
            if (bilalData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="11" class="text-center py-8 text-gray-500">
                            <div class="text-4xl mb-2">📢</div>
                            Tiada bilal didaftarkan lagi
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = bilalData.map((bilal, index) => `
                <tr class="table-row border-b hover:bg-blue-50 transition-colors">
                    <td class="py-3 px-4">${bilal.masjid}</td>
                    <td class="py-3 px-4">${bilal.daerah}</td>
                    <td class="py-3 px-4 font-medium">${bilal.nama}</td>
                    <td class="py-3 px-4">${bilal.nokp}</td>
                    <td class="py-3 px-4">${bilal.pekerjaan}</td>
                    <td class="py-3 px-4">${bilal.alamat}</td>
                    <td class="py-3 px-4">${bilal.telefon}</td>
                    <td class="py-3 px-4">${bilal.umur}</td>
                    <td class="py-3 px-4">${new Date(bilal.mulaKhidmat).toLocaleDateString('ms-MY')}</td>
                    <td class="py-3 px-4">${bilal.catatan || '-'}</td>
                    <td class="py-3 px-4">
                        <div class="flex gap-2">
                            <button onclick="editItem('bilal', ${index})" class="text-blue-600 hover:text-blue-800 text-sm">
                                ✏️ Edit
                            </button>
                            <button onclick="deleteItem('bilal', ${index})" class="text-red-600 hover:text-red-800 text-sm">
                                🗑️ Hapus
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Display siak
        function displaySiak() {
            const tbody = document.getElementById('siakList');
            
            if (siakData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="10" class="text-center py-8 text-gray-500">
                            <div class="text-4xl mb-2">📋</div>
                            Tiada siak didaftarkan lagi
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = siakData.map((siak, index) => `
                <tr class="table-row border-b hover:bg-blue-50 transition-colors">
                    <td class="py-3 px-4">${index + 1}</td>
                    <td class="py-3 px-4 font-medium">${siak.nama}</td>
                    <td class="py-3 px-4">${siak.nokp}</td>
                    <td class="py-3 px-4">${siak.noGaji}</td>
                    <td class="py-3 px-4">${siak.noAkaun}</td>
                    <td class="py-3 px-4">${siak.pekerjaan}</td>
                    <td class="py-3 px-4">${siak.alamat}</td>
                    <td class="py-3 px-4">${siak.telefon}</td>
                    <td class="py-3 px-4">${siak.masjid}</td>
                    <td class="py-3 px-4">${siak.daerah}</td>
                    <td class="py-3 px-4">${new Date(siak.mulaKhidmat).toLocaleDateString('ms-MY')}</td>
                    <td class="py-3 px-4">
                        <div class="flex gap-2">
                            <button onclick="editItem('siak', ${index})" class="text-blue-600 hover:text-blue-800 text-sm">
                                ✏️ Edit
                            </button>
                            <button onclick="deleteItem('siak', ${index})" class="text-red-600 hover:text-red-800 text-sm">
                                🗑️ Hapus
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Update statistics
        function updateStatistics() {
            document.getElementById('totalImam').textContent = imamData.length;
            document.getElementById('totalBilal').textContent = bilalData.length;
            document.getElementById('totalSiak').textContent = siakData.length;
            document.getElementById('totalPeletakan').textContent = peletakanData.length;
        }

        // Search functionality
        function searchTable(type) {
            const searchTerm = document.getElementById(`search${type.charAt(0).toUpperCase() + type.slice(1)}`).value.toLowerCase();
            const rows = document.querySelectorAll(`#${type}List tr`);
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        // Edit functionality
        function editItem(type, index) {
            if (type === 'imam' || type === 'bilal') {
                alert(`⚠️ Data ${type} tidak boleh diedit kerana diambil dari Google Sheets. Sila kemaskini data di Google Sheets dan muat semula.`);
                return;
            }
            
            currentEditType = type;
            currentEditIndex = index;
            
            const data = siakData[index];
            
            let modalContent = '';
                modalContent = `
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Nama Siak</label>
                            <input type="text" id="editNama" value="${data.nama}" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">No. K/P</label>
                            <input type="text" id="editNokp" value="${data.nokp}" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">No. Gaji</label>
                            <input type="text" id="editNoGaji" value="${data.noGaji}" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">No. Akaun BSN</label>
                            <input type="text" id="editNoAkaun" value="${data.noAkaun}" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Pekerjaan</label>
                            <input type="text" id="editPekerjaan" value="${data.pekerjaan}" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Alamat</label>
                            <textarea id="editAlamat" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg">${data.alamat}</textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">No. Tel</label>
                            <input type="tel" id="editTelefon" value="${data.telefon}" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Masjid</label>
                            <input type="text" id="editMasjid" value="${data.masjid}" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Daerah</label>
                            <input type="text" id="editDaerah" value="${data.daerah}" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Mula Khidmat</label>
                            <input type="date" id="editMulaKhidmat" value="${data.mulaKhidmat}" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('modalTitle').textContent = `Edit ${type.charAt(0).toUpperCase() + type.slice(1)}`;
            document.getElementById('modalContent').innerHTML = modalContent;
            document.getElementById('editModal').classList.remove('hidden');
            document.getElementById('editModal').classList.add('flex');
        }

        // Save edit
        function saveEdit() {
            siakData[currentEditIndex] = {
                ...siakData[currentEditIndex],
                nama: document.getElementById('editNama').value,
                nokp: document.getElementById('editNokp').value,
                noGaji: document.getElementById('editNoGaji').value,
                noAkaun: document.getElementById('editNoAkaun').value,
                pekerjaan: document.getElementById('editPekerjaan').value,
                alamat: document.getElementById('editAlamat').value,
                telefon: document.getElementById('editTelefon').value,
                masjid: document.getElementById('editMasjid').value,
                daerah: document.getElementById('editDaerah').value,
                mulaKhidmat: document.getElementById('editMulaKhidmat').value
            };
            localStorage.setItem('siakData', JSON.stringify(siakData));
            displaySiak();
            
            updateStatistics();
            closeModal();
            alert('✅ Data berjaya dikemaskini!');
        }

        // Close modal
        function closeModal() {
            document.getElementById('editModal').classList.add('hidden');
            document.getElementById('editModal').classList.remove('flex');
        }

        // Delete item
        function deleteItem(type, index) {
            if (type === 'imam' || type === 'bilal') {
                alert(`⚠️ Data ${type} tidak boleh dihapus kerana diambil dari Google Sheets. Sila kemaskini data di Google Sheets dan muat semula.`);
                return;
            }
            
            if (confirm('Adakah anda pasti ingin menghapus data ini?')) {
                siakData.splice(index, 1);
                localStorage.setItem('siakData', JSON.stringify(siakData));
                displaySiak();
                
                updateStatistics();
                alert('✅ Data berjaya dihapus!');
            }
        }

        // Clear all data
        function clearAllData(type) {
            if (type === 'imam') {
                alert('⚠️ Data imam tidak boleh dikosongkan kerana diambil dari Google Sheets. Data akan dimuat semula dari sumber asal.');
                loadImamDataFromSheet();
                return;
            }
            
            if (type === 'bilal') {
                alert('⚠️ Data bilal tidak boleh dikosongkan kerana diambil dari Google Sheets. Data akan dimuat semula dari sumber asal.');
                loadBilalDataFromSheet();
                return;
            }
            
            if (confirm(`Adakah anda pasti ingin mengosongkan semua data ${type}? Tindakan ini tidak boleh dibatalkan.`)) {
                siakData = [];
                localStorage.setItem('siakData', JSON.stringify(siakData));
                displaySiak();
                
                updateStatistics();
                alert('✅ Semua data telah dikosongkan!');
            }
        }

        // Export to PDF
        function exportToPDF(type) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('landscape'); // Set to landscape orientation
            
            // Add title
            doc.setFontSize(20);
            doc.text(`Laporan ${type.charAt(0).toUpperCase() + type.slice(1)}`, 20, 20);
            
            // Add date
            doc.setFontSize(12);
            doc.text(`Tarikh: ${new Date().toLocaleDateString('ms-MY')}`, 20, 35);
            
            let tableData = [];
            let headers = [];
            
            if (type === 'imam') {
                headers = ['Masjid', 'Daerah', 'Nama Imam', 'No. K/P', 'Pekerjaan', 'Alamat', 'No. Tel', 'Umur', 'Mula Khidmat', 'Catatan'];
                tableData = imamData.map((imam, index) => [
                    imam.masjid,
                    imam.daerah,
                    imam.nama,
                    imam.nokp,
                    imam.pekerjaan,
                    imam.alamat,
                    imam.telefon,
                    imam.umur,
                    new Date(imam.mulaKhidmat).toLocaleDateString('ms-MY'),
                    imam.catatan || '-'
                ]);
            } else if (type === 'bilal') {
                headers = ['Masjid', 'Daerah', 'Nama Bilal', 'No. K/P', 'Pekerjaan', 'Alamat', 'No. Tel', 'Umur', 'Mula Khidmat', 'Catatan'];
                tableData = bilalData.map((bilal, index) => [
                    bilal.masjid,
                    bilal.daerah,
                    bilal.nama,
                    bilal.nokp,
                    bilal.pekerjaan,
                    bilal.alamat,
                    bilal.telefon,
                    bilal.umur,
                    new Date(bilal.mulaKhidmat).toLocaleDateString('ms-MY'),
                    bilal.catatan || '-'
                ]);
            } else {
                headers = ['Bil', 'Nama Siak', 'No. K/P', 'No. Gaji', 'No. Akaun BSN', 'Pekerjaan', 'Alamat', 'No. Tel', 'Mula Khidmat'];
                tableData = siakData.map((siak, index) => [
                    index + 1,
                    siak.nama,
                    siak.nokp,
                    siak.noGaji,
                    siak.noAkaun,
                    siak.pekerjaan,
                    siak.alamat,
                    siak.telefon,
                    new Date(siak.mulaKhidmat).toLocaleDateString('ms-MY')
                ]);
            }
            
            doc.autoTable({
                head: [headers],
                body: tableData,
                startY: 45,
                styles: {
                    fontSize: 10,
                    cellPadding: 3
                },
                headStyles: {
                    fillColor: [30, 41, 59],
                    textColor: 255
                }
            });
            
            doc.save(`laporan-${type}-${new Date().toISOString().split('T')[0]}.pdf`);
        }

        // Generate and preview PDF report
        function generateReport(type) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('landscape'); // Set to landscape orientation
            
            // Add title
            doc.setFontSize(20);
            doc.text(`Laporan ${type.charAt(0).toUpperCase() + type.slice(1)}`, 20, 20);
            
            // Add date and time
            doc.setFontSize(12);
            doc.text(`Tarikh: ${new Date().toLocaleDateString('ms-MY')}`, 20, 35);
            doc.text(`Masa: ${new Date().toLocaleTimeString('ms-MY')}`, 20, 45);
            
            let tableData = [];
            let headers = [];
            let totalCount = 0;
            
            if (type === 'imam') {
                headers = ['Masjid', 'Daerah', 'Nama Imam', 'No. K/P', 'Pekerjaan', 'Alamat', 'No. Tel', 'Umur', 'Mula Khidmat', 'Catatan'];
                tableData = imamData.map((imam, index) => [
                    imam.masjid,
                    imam.daerah,
                    imam.nama,
                    imam.nokp,
                    imam.pekerjaan,
                    imam.alamat,
                    imam.telefon,
                    imam.umur,
                    new Date(imam.mulaKhidmat).toLocaleDateString('ms-MY'),
                    imam.catatan || '-'
                ]);
                totalCount = imamData.length;
            } else if (type === 'bilal') {
                headers = ['Masjid', 'Daerah', 'Nama Bilal', 'No. K/P', 'Pekerjaan', 'Alamat', 'No. Tel', 'Umur', 'Mula Khidmat', 'Catatan'];
                tableData = bilalData.map((bilal, index) => [
                    bilal.masjid,
                    bilal.daerah,
                    bilal.nama,
                    bilal.nokp,
                    bilal.pekerjaan,
                    bilal.alamat,
                    bilal.telefon,
                    bilal.umur,
                    new Date(bilal.mulaKhidmat).toLocaleDateString('ms-MY'),
                    bilal.catatan || '-'
                ]);
                totalCount = bilalData.length;
            } else {
                headers = ['Bil', 'Nama Siak', 'No. K/P', 'No. Gaji', 'No. Akaun BSN', 'Pekerjaan', 'Alamat', 'No. Tel', 'Mula Khidmat'];
                tableData = siakData.map((siak, index) => [
                    index + 1,
                    siak.nama,
                    siak.nokp,
                    siak.noGaji,
                    siak.noAkaun,
                    siak.pekerjaan,
                    siak.alamat,
                    siak.telefon,
                    new Date(siak.mulaKhidmat).toLocaleDateString('ms-MY')
                ]);
                totalCount = siakData.length;
            }
            
            // Add total count
            doc.text(`Jumlah ${type.charAt(0).toUpperCase() + type.slice(1)}: ${totalCount} orang`, 20, 55);
            
            doc.autoTable({
                head: [headers],
                body: tableData,
                startY: 65,
                styles: {
                    fontSize: 9,
                    cellPadding: 2
                },
                headStyles: {
                    fillColor: [30, 41, 59],
                    textColor: 255,
                    fontSize: 10,
                    fontStyle: 'bold'
                },
                columnStyles: {
                    0: { cellWidth: 15 }, // Bil
                    1: { cellWidth: 40 }, // Nama
                    2: { cellWidth: 35 }, // No. K/P
                    3: { cellWidth: 25 }, // No. Gaji
                    4: { cellWidth: 30 }, // No. Akaun BSN
                    5: { cellWidth: 30 }, // Pekerjaan
                    6: { cellWidth: 50 }, // Alamat
                    7: { cellWidth: 30 }, // No. Tel
                    8: { cellWidth: 25 }  // Mula Khidmat
                }
            });
            
            // Convert PDF to blob and show preview
            const pdfBlob = doc.output('blob');
            const pdfUrl = URL.createObjectURL(pdfBlob);
            
            // Show PDF preview modal
            showPDFPreview(pdfUrl, type);
        }

        // Generate report
        function generateReport(type) {
            exportToPDF(type);
        }

        // Peletakan form submissions
        document.getElementById('peletakanImamForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const selectedImam = document.getElementById('pilihImam').value;
            
            if (!selectedImam) {
                alert('Sila pilih imam!');
                return;
            }
            
            const imam = imamData.find(i => i.id == selectedImam);
            
            const perletakanItem = {
                id: Date.now(),
                nama: imam.nama,
                jenis: 'Imam',
                peletakan: 'Imam Masjid',
                jadualBidang: 'Solat 5 Waktu & Jumaat',
                masjid: 'Masjid Utama',
                catatan: document.getElementById('catatanImam').value || '-'
            };
            
            peletakanData.push(perletakanItem);
            localStorage.setItem('peletakanData', JSON.stringify(peletakanData));
            
            this.reset();
            displayPeletakan();
            updateStatistics();
            
            alert('✅ Perletakan imam berjaya ditetapkan!');
        });

        document.getElementById('peletakanBilalForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const selectedBilal = document.getElementById('pilihBilal').value;
            
            if (!selectedBilal) {
                alert('Sila pilih bilal!');
                return;
            }
            
            const bilal = bilalData.find(b => b.id == selectedBilal);
            
            const perletakanItem = {
                id: Date.now(),
                nama: bilal.nama,
                jenis: 'Bilal',
                peletakan: 'Bilal Masjid',
                jadualBidang: 'Solat 5 Waktu & Jumaat',
                masjid: 'Masjid Utama',
                catatan: document.getElementById('catatanBilal').value || '-'
            };
            
            peletakanData.push(perletakanItem);
            localStorage.setItem('peletakanData', JSON.stringify(peletakanData));
            
            this.reset();
            displayPeletakan();
            updateStatistics();
            
            alert('✅ Perletakan bilal berjaya ditetapkan!');
        });

        document.getElementById('peletakanSiakForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const selectedSiak = document.getElementById('pilihSiak').value;
            
            if (!selectedSiak) {
                alert('Sila pilih siak!');
                return;
            }
            
            const siak = siakData.find(s => s.id == selectedSiak);
            
            const perletakanItem = {
                id: Date.now(),
                nama: siak.nama,
                jenis: 'Siak',
                peletakan: 'Siak Masjid',
                jadualBidang: 'Pengurusan Masjid',
                masjid: 'Masjid Utama',
                catatan: document.getElementById('catatanSiak').value || '-'
            };
            
            peletakanData.push(perletakanItem);
            localStorage.setItem('peletakanData', JSON.stringify(peletakanData));
            
            this.reset();
            displayPeletakan();
            updateStatistics();
            
            alert('✅ Perletakan siak berjaya ditetapkan!');
        });

        // Update peletakan dropdowns
        function updatePeletakanDropdowns() {
            // Update Imam dropdown
            const pilihImam = document.getElementById('pilihImam');
            pilihImam.innerHTML = '<option value="">Pilih Imam</option>';
            imamData.forEach(imam => {
                pilihImam.innerHTML += `<option value="${imam.id}">${imam.nama}</option>`;
            });

            // Update Bilal dropdown
            const pilihBilal = document.getElementById('pilihBilal');
            pilihBilal.innerHTML = '<option value="">Pilih Bilal</option>';
            bilalData.forEach(bilal => {
                pilihBilal.innerHTML += `<option value="${bilal.id}">${bilal.nama}</option>`;
            });

            // Update Siak dropdown
            const pilihSiak = document.getElementById('pilihSiak');
            pilihSiak.innerHTML = '<option value="">Pilih Siak</option>';
            siakData.forEach(siak => {
                pilihSiak.innerHTML += `<option value="${siak.id}">${siak.nama}</option>`;
            });
        }

        // Display peletakan
        function displayPeletakan() {
            const tbody = document.getElementById('peletakanList');
            
            if (peletakanData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center py-8 text-gray-500">
                            <div class="text-4xl mb-2">📍</div>
                            Tiada perletakan ditetapkan lagi
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = peletakanData.map((perletakan, index) => `
                <tr class="table-row border-b hover:bg-blue-50 transition-colors">
                    <td class="py-3 px-4">${index + 1}</td>
                    <td class="py-3 px-4 font-medium">${perletakan.nama}</td>
                    <td class="py-3 px-4">${perletakan.jenis}</td>
                    <td class="py-3 px-4">${perletakan.peletakan}</td>
                    <td class="py-3 px-4">${perletakan.jadualBidang}</td>
                    <td class="py-3 px-4">${perletakan.masjid}</td>
                    <td class="py-3 px-4">${perletakan.catatan || '-'}</td>
                    <td class="py-3 px-4">
                        <button onclick="deletePeletakan(${index})" class="text-red-600 hover:text-red-800 text-sm">
                            🗑️ Hapus
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Delete perletakan
        function deletePeletakan(index) {
            if (confirm('Adakah anda pasti ingin menghapus perletakan ini?')) {
                peletakanData.splice(index, 1);
                localStorage.setItem('peletakanData', JSON.stringify(peletakanData));
                displayPeletakan();
                updateStatistics();
                alert('✅ Perletakan berjaya dihapus!');
            }
        }

        // Clear all perletakan
        function clearAllPeletakan() {
            if (confirm('Adakah anda pasti ingin mengosongkan semua perletakan? Tindakan ini tidak boleh dibatalkan.')) {
                peletakanData = [];
                localStorage.setItem('peletakanData', JSON.stringify(peletakanData));
                displayPeletakan();
                updateStatistics();
                alert('✅ Semua perletakan telah dikosongkan!');
            }
        }

        // Export perletakan to PDF
        function exportPeletakanToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('landscape'); // Set to landscape orientation
            
            // Add title
            doc.setFontSize(20);
            doc.text('Laporan Perletakan Pegawai', 20, 20);
            
            // Add date
            doc.setFontSize(12);
            doc.text(`Tarikh: ${new Date().toLocaleDateString('ms-MY')}`, 20, 35);
            
            const headers = ['Bil', 'Nama', 'Jenis', 'Perletakan', 'Jadual/Bidang', 'Masjid', 'Catatan'];
            const tableData = peletakanData.map((perletakan, index) => [
                index + 1,
                perletakan.nama,
                perletakan.jenis,
                perletakan.peletakan,
                perletakan.jadualBidang,
                perletakan.masjid,
                perletakan.catatan || '-'
            ]);
            
            doc.autoTable({
                head: [headers],
                body: tableData,
                startY: 45,
                styles: {
                    fontSize: 10,
                    cellPadding: 3
                },
                headStyles: {
                    fillColor: [30, 41, 59],
                    textColor: 255
                }
            });
            
            doc.save(`laporan-perletakan-${new Date().toISOString().split('T')[0]}.pdf`);
        }

        // PDF Preview Functions
        let currentPDFBlob = null;
        let currentPDFType = '';

        function showPDFPreview(pdfUrl, type) {
            document.getElementById('pdfModalTitle').textContent = `Pratonton Laporan ${type.charAt(0).toUpperCase() + type.slice(1)}`;
            document.getElementById('pdfViewer').src = pdfUrl;
            document.getElementById('pdfPreviewModal').classList.remove('hidden');
            document.getElementById('pdfPreviewModal').classList.add('flex');
            
            // Store current PDF info for download/print
            currentPDFType = type;
            
            // Convert URL to blob for download
            fetch(pdfUrl)
                .then(response => response.blob())
                .then(blob => {
                    currentPDFBlob = blob;
                });
        }

        function closePDFModal() {
            document.getElementById('pdfPreviewModal').classList.add('hidden');
            document.getElementById('pdfPreviewModal').classList.remove('flex');
            document.getElementById('pdfViewer').src = '';
            
            // Clean up blob URL
            if (currentPDFBlob) {
                URL.revokeObjectURL(document.getElementById('pdfViewer').src);
                currentPDFBlob = null;
            }
        }

        function downloadCurrentPDF() {
            if (currentPDFBlob) {
                const url = URL.createObjectURL(currentPDFBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `laporan-${currentPDFType}-${new Date().toISOString().split('T')[0]}.pdf`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
        }

        function printCurrentPDF() {
            if (document.getElementById('pdfViewer').src) {
                const printWindow = window.open(document.getElementById('pdfViewer').src, '_blank');
                printWindow.onload = function() {
                    printWindow.print();
                };
            }
        }

        // Global search functionality
        function performGlobalSearch() {
            const searchTerm = document.getElementById('globalSearch').value.toLowerCase().trim();
            
            if (!searchTerm) {
                alert('Sila masukkan nama atau no. K/P untuk carian!');
                return;
            }
            
            const results = [];
            
            // Search in Imam data
            imamData.forEach((imam, index) => {
                if (imam.nama.toLowerCase().includes(searchTerm) || imam.nokp.includes(searchTerm)) {
                    results.push({
                        type: 'Imam',
                        data: imam,
                        index: index,
                        icon: '🕌'
                    });
                }
            });
            
            // Search in Bilal data
            bilalData.forEach((bilal, index) => {
                if (bilal.nama.toLowerCase().includes(searchTerm) || bilal.nokp.includes(searchTerm)) {
                    results.push({
                        type: 'Bilal',
                        data: bilal,
                        index: index,
                        icon: '📢'
                    });
                }
            });
            
            // Search in Siak data
            siakData.forEach((siak, index) => {
                if (siak.nama.toLowerCase().includes(searchTerm) || siak.nokp.includes(searchTerm)) {
                    results.push({
                        type: 'Siak',
                        data: siak,
                        index: index,
                        icon: '📋'
                    });
                }
            });
            
            displayGlobalSearchResults(results, searchTerm);
        }
        
        // Store search results globally for PDF export
        let currentSearchResults = [];
        let currentSearchTerm = '';

        function displayGlobalSearchResults(results, searchTerm) {
            const resultsContainer = document.getElementById('globalSearchResults');
            const resultsContent = document.getElementById('searchResultsContent');
            const exportBtn = document.getElementById('exportSearchBtn');
            
            // Store results for PDF export
            currentSearchResults = results;
            currentSearchTerm = searchTerm;
            
            if (results.length === 0) {
                resultsContent.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <div class="text-4xl mb-2">🔍</div>
                        <p>Tiada keputusan ditemui untuk "<strong>${searchTerm}</strong>"</p>
                        <p class="text-sm mt-2">Cuba cari menggunakan nama penuh atau no. K/P yang tepat</p>
                    </div>
                `;
                exportBtn.classList.add('hidden');
            } else {
                resultsContent.innerHTML = results.map(result => `
                    <div class="bg-white border border-gray-200 rounded-xl p-4 shadow-sm hover:shadow-md transition-shadow">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <div class="flex items-center mb-2">
                                    <span class="text-2xl mr-2">${result.icon}</span>
                                    <span class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded-full">${result.type}</span>
                                </div>
                                <h4 class="text-lg font-semibold text-gray-800 mb-1">${result.data.nama}</h4>
                                <div class="grid grid-cols-2 gap-4 text-sm text-gray-600">
                                    <div><strong>Masjid:</strong> ${result.data.masjid}</div>
                                    <div><strong>Daerah:</strong> ${result.data.daerah}</div>
                                    <div><strong>No. K/P:</strong> ${result.data.nokp}</div>

                                    <div><strong>Pekerjaan:</strong> ${result.data.pekerjaan}</div>
                                    <div class="col-span-2"><strong>Alamat:</strong> ${result.data.alamat}</div>
                                    <div><strong>No. Tel:</strong> ${result.data.telefon}</div>
                                    <div><strong>Umur:</strong> ${result.data.umur || '-'}</div>
                                    <div><strong>Mula Khidmat:</strong> ${new Date(result.data.mulaKhidmat).toLocaleDateString('ms-MY')}</div>
                                    <div class="col-span-2"><strong>Catatan:</strong> ${result.data.catatan || '-'}</div>
                                </div>
                            </div>
                            <div class="flex flex-col gap-2 ml-4">
                                <button onclick="editItem('${result.type.toLowerCase()}', ${result.index})" class="text-blue-600 hover:text-blue-800 text-sm px-3 py-1 border border-blue-300 rounded-lg hover:bg-blue-50 transition-colors">
                                    ✏️ Edit
                                </button>
                                <button onclick="goToTab('${result.type.toLowerCase()}')" class="text-green-600 hover:text-green-800 text-sm px-3 py-1 border border-green-300 rounded-lg hover:bg-green-50 transition-colors">
                                    👁️ Lihat
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
                exportBtn.classList.remove('hidden');
            }
            
            resultsContainer.classList.remove('hidden');
            
            // Scroll to results
            resultsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Export search results to PDF
        function exportSearchResultsToPDF() {
            if (currentSearchResults.length === 0) {
                alert('Tiada hasil carian untuk dicetak!');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('landscape'); // Landscape orientation
            
            // Add title
            doc.setFontSize(20);
            doc.text('Laporan Hasil Carian Pegawai Masjid', 20, 20);
            
            // Add search term
            doc.setFontSize(14);
            doc.text(`Kata Kunci Carian: "${currentSearchTerm}"`, 20, 35);
            
            // Add date and time
            doc.setFontSize(12);
            doc.text(`Tarikh: ${new Date().toLocaleDateString('ms-MY')}`, 20, 45);
            doc.text(`Masa: ${new Date().toLocaleTimeString('ms-MY')}`, 20, 55);
            doc.text(`Jumlah Keputusan: ${currentSearchResults.length} rekod`, 20, 65);
            
            // Prepare table data
            const headers = ['Bil', 'Jenis', 'Nama', 'No. K/P', 'Pekerjaan', 'Masjid', 'Daerah', 'No. Tel', 'Umur', 'Mula Khidmat'];
            const tableData = currentSearchResults.map((result, index) => [
                index + 1,
                result.type,
                result.data.nama,
                result.data.nokp,
                result.data.pekerjaan,
                result.data.masjid,
                result.data.daerah,
                result.data.telefon,
                result.data.umur || '-',
                new Date(result.data.mulaKhidmat).toLocaleDateString('ms-MY')
            ]);
            
            doc.autoTable({
                head: [headers],
                body: tableData,
                startY: 75,
                styles: {
                    fontSize: 9,
                    cellPadding: 2
                },
                headStyles: {
                    fillColor: [30, 41, 59],
                    textColor: 255,
                    fontSize: 10,
                    fontStyle: 'bold'
                },
                columnStyles: {
                    0: { cellWidth: 15 }, // Bil
                    1: { cellWidth: 20 }, // Jenis
                    2: { cellWidth: 40 }, // Nama
                    3: { cellWidth: 35 }, // No. K/P
                    4: { cellWidth: 25 }, // No. Gaji
                    5: { cellWidth: 30 }, // No. Akaun BSN
                    6: { cellWidth: 30 }, // Pekerjaan
                    7: { cellWidth: 35 }, // Masjid
                    8: { cellWidth: 25 }, // Daerah
                    9: { cellWidth: 25 }, // No. Tel
                    10: { cellWidth: 25 } // Mula Khidmat
                }
            });
            
            // Add detailed information on new page if needed
            if (currentSearchResults.length <= 10) {
                doc.addPage();
                doc.setFontSize(16);
                doc.text('Maklumat Terperinci', 20, 20);
                
                let yPosition = 35;
                currentSearchResults.forEach((result, index) => {
                    if (yPosition > 180) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    doc.setFontSize(12);
                    doc.setFont(undefined, 'bold');
                    doc.text(`${index + 1}. ${result.data.nama} (${result.type})`, 20, yPosition);
                    
                    doc.setFont(undefined, 'normal');
                    doc.setFontSize(10);
                    yPosition += 8;
                    
                    let details = [
                        `Masjid: ${result.data.masjid}`,
                        `Daerah: ${result.data.daerah}`,
                        `No. K/P: ${result.data.nokp}`,
                        `Pekerjaan: ${result.data.pekerjaan}`,
                        `Alamat: ${result.data.alamat}`,
                        `No. Tel: ${result.data.telefon}`,
                        `Umur: ${result.data.umur || '-'}`,
                        `Mula Khidmat: ${new Date(result.data.mulaKhidmat).toLocaleDateString('ms-MY')}`,
                        `Catatan: ${result.data.catatan || '-'}`
                    ];
                    
                    // Add specific fields for Bilal and Siak
                    if (result.type === 'Bilal' || result.type === 'Siak') {
                        details.splice(3, 0, `No. Gaji: ${result.data.noGaji}`);
                        details.splice(4, 0, `No. Akaun BSN: ${result.data.noAkaun}`);
                    }
                    
                    details.forEach(detail => {
                        doc.text(detail, 25, yPosition);
                        yPosition += 5;
                    });
                    
                    yPosition += 5; // Extra space between records
                });
            }
            
            doc.save(`hasil-carian-${currentSearchTerm.replace(/\s+/g, '-')}-${new Date().toISOString().split('T')[0]}.pdf`);
        }
        
        function clearGlobalSearch() {
            document.getElementById('globalSearch').value = '';
            document.getElementById('globalSearchResults').classList.add('hidden');
            document.getElementById('exportSearchBtn').classList.add('hidden');
            currentSearchResults = [];
            currentSearchTerm = '';
        }
        
        function goToTab(type) {
            showTab(type);
            // Scroll to the tab content
            document.getElementById(type + '-tab').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Toggle functions for forms and lists        
        function toggleImamList() {
            const listSection = document.getElementById('imamListSection');
            const listBtn = document.getElementById('toggleImamListBtn');
            
            if (listSection.classList.contains('hidden')) {
                listSection.classList.remove('hidden');
                listBtn.classList.remove('btn-secondary');
                listBtn.classList.add('btn-primary');
                listBtn.innerHTML = '❌ Tutup Senarai';
            } else {
                listSection.classList.add('hidden');
                listBtn.classList.remove('btn-primary');
                listBtn.classList.add('btn-secondary');
                listBtn.innerHTML = '📋 Lihat Senarai Imam';
            }
        }
        
        function toggleBilalList() {
            const listSection = document.getElementById('bilalListSection');
            const listBtn = document.getElementById('toggleBilalListBtn');
            
            if (listSection.classList.contains('hidden')) {
                listSection.classList.remove('hidden');
                listBtn.classList.remove('btn-secondary');
                listBtn.classList.add('btn-primary');
                listBtn.innerHTML = '❌ Tutup Senarai';
            } else {
                listSection.classList.add('hidden');
                listBtn.classList.remove('btn-primary');
                listBtn.classList.add('btn-secondary');
                listBtn.innerHTML = '📋 Lihat Senarai Bilal';
            }
        }
        
        function toggleSiakForm() {
            const formSection = document.getElementById('siakFormSection');
            const listSection = document.getElementById('siakListSection');
            const formBtn = document.getElementById('toggleSiakFormBtn');
            const listBtn = document.getElementById('toggleSiakListBtn');
            
            if (formSection.classList.contains('hidden')) {
                formSection.classList.remove('hidden');
                listSection.classList.add('hidden');
                formBtn.classList.remove('btn-purple');
                formBtn.classList.add('btn-secondary');
                formBtn.innerHTML = '❌ Tutup Borang';
                listBtn.classList.remove('btn-secondary');
                listBtn.classList.add('btn-purple');
                listBtn.innerHTML = '📋 Lihat Senarai Siak';
            } else {
                formSection.classList.add('hidden');
                formBtn.classList.remove('btn-secondary');
                formBtn.classList.add('btn-purple');
                formBtn.innerHTML = '➕ Daftar Siak Baru';
            }
        }
        
        function toggleSiakList() {
            const formSection = document.getElementById('siakFormSection');
            const listSection = document.getElementById('siakListSection');
            const formBtn = document.getElementById('toggleSiakFormBtn');
            const listBtn = document.getElementById('toggleSiakListBtn');
            
            if (listSection.classList.contains('hidden')) {
                listSection.classList.remove('hidden');
                formSection.classList.add('hidden');
                listBtn.classList.remove('btn-secondary');
                listBtn.classList.add('btn-purple');
                listBtn.innerHTML = '❌ Tutup Senarai';
                formBtn.classList.remove('btn-secondary');
                formBtn.classList.add('btn-purple');
                formBtn.innerHTML = '➕ Daftar Siak Baru';
            } else {
                listSection.classList.add('hidden');
                listBtn.classList.remove('btn-purple');
                listBtn.classList.add('btn-secondary');
                listBtn.innerHTML = '📋 Lihat Senarai Siak';
            }
        }

        // Close modal when clicking outside
        document.getElementById('editModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98f48f7fc7c9e454',t:'MTc2MDU4NjI5Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>