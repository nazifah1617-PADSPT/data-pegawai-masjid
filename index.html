<!doctype html>
<html lang="ms">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistem Carian Maklumat Pegawai Masjid</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>
  <script src="https://unpkg.com/jspdf-autotable@latest/dist/jspdf.plugin.autotable.min.js"></script>
  <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap');
        body { 
            font-family: 'Poppins', sans-serif; 
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #cbd5e1 100%);
            background-attachment: fixed;
            min-height: 100vh;
            box-sizing: border-box;
        }
        .gradient-bg { 
            background: linear-gradient(135deg, #1e293b 0%, #334155 50%, #475569 100%); 
            position: relative;
            overflow: hidden;
        }
        .gradient-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1.5" fill="white" opacity="0.15"/><circle cx="75" cy="75" r="1.5" fill="white" opacity="0.15"/><circle cx="50" cy="10" r="1" fill="white" opacity="0.1"/><circle cx="10" cy="60" r="1" fill="white" opacity="0.1"/><circle cx="90" cy="40" r="1" fill="white" opacity="0.1"/><circle cx="30" cy="80" r="0.5" fill="white" opacity="0.2"/><circle cx="70" cy="20" r="0.5" fill="white" opacity="0.2"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
        }
        .card-hover { 
            position: relative;
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .search-input { 
            transition: all 0.4s ease; 
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }
        .search-input:focus { 
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2), 0 8px 25px rgba(0,0,0,0.1); 
            background: rgba(255, 255, 255, 1);
        }
        .btn-primary {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            box-shadow: 0 8px 25px rgba(30, 41, 59, 0.3);
            border: none;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        .btn-primary:hover::before {
            left: 100%;
        }
        .btn-primary:hover {
            box-shadow: 0 15px 35px rgba(30, 41, 59, 0.4);
            transform: translateY(-2px);
        }
        .btn-secondary {
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
            box-shadow: 0 8px 25px rgba(100, 116, 139, 0.3);
            transition: all 0.3s ease;
        }
        .btn-secondary:hover {
            box-shadow: 0 15px 35px rgba(100, 116, 139, 0.4);
            transform: translateY(-2px);
        }
        .btn-success {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            box-shadow: 0 8px 25px rgba(5, 150, 105, 0.3);
            transition: all 0.3s ease;
        }
        .btn-success:hover {
            box-shadow: 0 15px 35px rgba(5, 150, 105, 0.4);
            transform: translateY(-2px);
        }
        .btn-purple {
            background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
            color: white !important;
            box-shadow: 0 8px 25px rgba(124, 58, 237, 0.3);
            transition: all 0.3s ease;
        }
        .btn-purple:hover {
            box-shadow: 0 15px 35px rgba(124, 58, 237, 0.4);
            transform: translateY(-2px);
        }
        .btn-danger {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            box-shadow: 0 8px 25px rgba(220, 38, 38, 0.3);
            transition: all 0.3s ease;
        }
        .btn-danger:hover {
            box-shadow: 0 15px 35px rgba(220, 38, 38, 0.4);
            transform: translateY(-2px);
        }
        .mosque-icon {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .fade-in {
            animation: fadeIn 0.6s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .table-row:hover {
            background: rgba(59, 130, 246, 0.05);
        }
        .modal-backdrop {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body><!-- Header -->
  <header class="gradient-bg text-white shadow-2xl relative z-10">
   <div class="container mx-auto px-6 py-8">
    <div class="flex items-center justify-between">
     <div class="flex items-center space-x-4">
      <div class="text-4xl mosque-icon">
       üïå
      </div>
      <div>
       <h1 class="text-3xl font-bold">Sistem Carian Maklumat Pegawai Masjid</h1>
       <p class="text-slate-300 text-sm">Pengurusan Pegawai Imam, Bilal &amp; Siak</p>
      </div>
     </div>
     <div class="text-right">
      <p class="text-sm text-slate-300">Tarikh: <span id="currentDate"></span></p>
      <p class="text-sm text-slate-300">Masa: <span id="currentTime"></span></p>
     </div>
    </div>
   </div>
  </header><!-- Main Content -->
  <main class="container mx-auto px-6 py-8"><!-- Global Search -->
   <div class="mb-6">
    <div class="card-hover rounded-2xl p-6 shadow-xl">
     <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center"><span class="text-2xl mr-3">üîç</span> Carian Pegawai Masjid</h2>
     <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
      <div><label class="block text-sm font-medium text-gray-700 mb-2">Pilih Masjid</label> <select id="filterMasjid" class="search-input w-full px-4 py-3 border border-gray-300 rounded-xl"> <option value="">Semua Masjid</option> </select>
      </div>
      <div><label class="block text-sm font-medium text-gray-700 mb-2">Pilih Jawatan</label> <select id="filterJawatan" class="search-input w-full px-4 py-3 border border-gray-300 rounded-xl"> <option value="">Semua Jawatan</option> <option value="imam">Imam</option> <option value="bilal">Bilal</option> <option value="siak">Siak</option> </select>
      </div>
      <div class="md:col-span-1"><label class="block text-sm font-medium text-gray-700 mb-2">Carian (Nama atau No. K/P)</label> <input type="text" id="globalSearch" placeholder="üîç Cari nama atau no. K/P..." class="search-input w-full px-4 py-3 border border-gray-300 rounded-xl">
      </div>
     </div>
     <div class="flex gap-4"><button onclick="performGlobalSearch()" class="btn-primary text-white px-6 py-3 rounded-xl font-medium"> üîç Cari </button> <button onclick="clearGlobalSearch()" class="btn-secondary text-white px-6 py-3 rounded-xl font-medium"> üóëÔ∏è Kosongkan </button>
     </div>
     <div id="globalSearchResults" class="mt-4 hidden">
      <div class="flex justify-between items-center mb-3">
       <h3 class="text-lg font-semibold text-gray-800">Keputusan Carian:</h3><button onclick="exportSearchResultsToPDF()" id="exportSearchBtn" class="btn-purple text-white px-4 py-2 rounded-lg font-medium text-sm hidden"> üìÑ Cetak PDF Hasil Carian </button>
      </div>
      <div id="searchResultsContent" class="space-y-3"></div>
     </div>
    </div>
   </div><!-- Navigation Tabs -->
   <div class="mb-8">
    <div class="flex flex-wrap gap-2 bg-white/80 backdrop-blur-sm p-2 rounded-2xl shadow-lg"><button onclick="showTab('imam')" id="tab-imam" class="tab-btn btn-primary text-white px-6 py-3 rounded-xl font-medium transition-all"> üïå Imam </button> <button onclick="showTab('bilal')" id="tab-bilal" class="tab-btn bg-gray-200 text-gray-700 px-6 py-3 rounded-xl font-medium transition-all hover:bg-gray-300"> üì¢ Bilal </button> <button onclick="showTab('siak')" id="tab-siak" class="tab-btn bg-gray-200 text-gray-700 px-6 py-3 rounded-xl font-medium transition-all hover:bg-gray-300"> üìã Siak </button> <button onclick="showTab('laporan')" id="tab-laporan" class="tab-btn bg-gray-200 text-gray-700 px-6 py-3 rounded-xl font-medium transition-all hover:bg-gray-300"> üìä Laporan </button>
    </div>
   </div><!-- Imam Tab -->
   <div id="imam-tab" class="tab-content fade-in"><!-- Control Buttons -->
    <div class="mb-6 flex gap-4"><button onclick="toggleImamList()" id="toggleImamListBtn" class="btn-secondary text-white px-6 py-3 rounded-xl font-medium"> üìã Lihat Senarai Imam </button>
    </div>
    <div class="grid lg:grid-cols-1 gap-8"><!-- Senarai Imam -->
     <div id="imamListSection" class="lg:col-span-1 hidden">
      <div class="card-hover rounded-2xl p-6 shadow-xl">
       <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-gray-800 flex items-center"><span class="text-2xl mr-3">üïå</span> Senarai Imam</h2>
        <div class="flex gap-2"><button onclick="exportToPDF('imam')" class="btn-purple text-white px-4 py-2 rounded-lg font-medium text-sm"> üìÑ Export PDF </button>
        </div>
       </div>
       <div class="overflow-x-auto">
        <table class="w-full">
         <thead>
          <tr class="bg-gray-50 border-b">
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Masjid</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Daerah</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Nama Imam</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">No. K/P</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Pekerjaan</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Alamat</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">No. Tel</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Umur</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Mula Khidmat</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Catatan</th>
          </tr>
         </thead>
         <tbody id="imamList">
          <tr>
           <td colspan="10" class="text-center py-8 text-gray-500">
            <div class="text-4xl mb-2">
             üïå
            </div> Tiada imam didaftarkan lagi</td>
          </tr>
         </tbody>
        </table>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Bilal Tab -->
   <div id="bilal-tab" class="tab-content hidden"><!-- Control Buttons -->
    <div class="mb-6 flex gap-4"><button onclick="toggleBilalList()" id="toggleBilalListBtn" class="btn-secondary text-white px-6 py-3 rounded-xl font-medium"> üìã Lihat Senarai Bilal </button>
    </div>
    <div class="grid lg:grid-cols-1 gap-8"><!-- Senarai Bilal -->
     <div id="bilalListSection" class="lg:col-span-1 hidden">
      <div class="card-hover rounded-2xl p-6 shadow-xl">
       <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-gray-800 flex items-center"><span class="text-2xl mr-3">üì¢</span> Senarai Bilal</h2>
        <div class="flex gap-2"><button onclick="exportToPDF('bilal')" class="btn-purple text-white px-4 py-2 rounded-lg font-medium text-sm"> üìÑ Export PDF </button>
        </div>
       </div>
       <div class="overflow-x-auto">
        <table class="w-full">
         <thead>
          <tr class="bg-gray-50 border-b">
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Masjid</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Daerah</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Nama Bilal</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">No. K/P</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Pekerjaan</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Alamat</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">No. Tel</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Umur</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Mula Khidmat</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Catatan</th>
          </tr>
         </thead>
         <tbody id="bilalList">
          <tr>
           <td colspan="10" class="text-center py-8 text-gray-500">
            <div class="text-4xl mb-2">
             üì¢
            </div> Tiada bilal didaftarkan lagi</td>
          </tr>
         </tbody>
        </table>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Siak Tab -->
   <div id="siak-tab" class="tab-content hidden"><!-- Control Buttons -->
    <div class="mb-6 flex gap-4"><button onclick="toggleSiakForm()" id="toggleSiakFormBtn" class="btn-purple text-white px-6 py-3 rounded-xl font-medium"> ‚ûï Daftar Siak Baru </button> <button onclick="toggleSiakList()" id="toggleSiakListBtn" class="btn-secondary text-white px-6 py-3 rounded-xl font-medium"> üìã Lihat Senarai Siak </button>
    </div>
    <div class="grid lg:grid-cols-3 gap-8"><!-- Form Siak -->
     <div id="siakFormSection" class="lg:col-span-1 hidden">
      <div class="card-hover rounded-2xl p-6 shadow-xl">
       <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center"><span class="text-2xl mr-3">üìã</span> Daftar Siak</h2>
       <form id="siakForm" class="space-y-4">
        <div><label class="block text-sm font-medium text-gray-700 mb-2">Nama Siak</label> <input type="text" id="namaSiak" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
        </div>
        <div><label class="block text-sm font-medium text-gray-700 mb-2">No. K/P</label> <input type="text" id="nokpSiak" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
        </div>
        <div><label class="block text-sm font-medium text-gray-700 mb-2">No. Gaji</label> <input type="text" id="noGajiSiak" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Contoh: G001234">
        </div>
        <div><label class="block text-sm font-medium text-gray-700 mb-2">No. Akaun BSN</label> <input type="text" id="noAkaunSiak" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Contoh: 1234567890">
        </div>
        <div><label class="block text-sm font-medium text-gray-700 mb-2">Pekerjaan</label> <input type="text" id="pekerjaanSiak" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Contoh: Guru Agama">
        </div>
        <div><label class="block text-sm font-medium text-gray-700 mb-2">Alamat</label> <textarea id="alamatSiak" required rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"></textarea>
        </div>
        <div><label class="block text-sm font-medium text-gray-700 mb-2">No. Tel</label> <input type="tel" id="telefonSiak" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
        </div>
        <div><label class="block text-sm font-medium text-gray-700 mb-2">Masjid</label> <input type="text" id="masjidSiak" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Contoh: Masjid Al-Hidayah">
        </div>
        <div><label class="block text-sm font-medium text-gray-700 mb-2">Daerah</label> <input type="text" id="daerahSiak" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Contoh: Kuala Lumpur">
        </div>
        <div><label class="block text-sm font-medium text-gray-700 mb-2">Mula Khidmat</label> <input type="date" id="mulaKhidmatSiak" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
        </div><button type="submit" class="w-full btn-purple text-white py-3 px-6 rounded-xl font-medium"> ‚úÖ Daftar Siak </button>
       </form>
      </div>
     </div><!-- Senarai Siak -->
     <div id="siakListSection" class="lg:col-span-3 hidden">
      <div class="card-hover rounded-2xl p-6 shadow-xl">
       <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-gray-800 flex items-center"><span class="text-2xl mr-3">üìã</span> Senarai Siak</h2>
        <div class="flex gap-2"><button onclick="exportToPDF('siak')" class="btn-purple text-white px-4 py-2 rounded-lg font-medium text-sm"> üìÑ Export PDF </button> <button onclick="clearAllData('siak')" class="btn-danger text-white px-4 py-2 rounded-lg font-medium text-sm"> üóëÔ∏è Kosongkan </button>
        </div>
       </div>
       <div class="mb-4"><input type="text" id="searchSiak" placeholder="üîç Cari siak..." class="search-input w-full px-4 py-3 border border-gray-300 rounded-xl">
       </div>
       <div class="overflow-x-auto">
        <table class="w-full">
         <thead>
          <tr class="bg-gray-50 border-b">
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Bil</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Nama Siak</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">No. K/P</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">No. Gaji</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">No. Akaun BSN</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Pekerjaan</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Alamat</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">No. Tel</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Masjid</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Daerah</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Mula Khidmat</th>
           <th class="text-left py-3 px-4 font-semibold text-gray-700">Tindakan</th>
          </tr>
         </thead>
         <tbody id="siakList">
          <tr>
           <td colspan="12" class="text-center py-8 text-gray-500">
            <div class="text-4xl mb-2">
             üìã
            </div> Tiada siak didaftarkan lagi</td>
          </tr>
         </tbody>
        </table>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Laporan Tab -->
   <div id="laporan-tab" class="tab-content hidden">
    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8"><!-- Statistik Cards -->
     <div class="card-hover rounded-2xl p-6 shadow-xl text-center">
      <div class="text-4xl mb-3">
       üïå
      </div>
      <h3 class="text-lg font-bold text-gray-800">Jumlah Imam</h3>
      <p class="text-3xl font-bold text-blue-600" id="totalImam">0</p>
     </div>
     <div class="card-hover rounded-2xl p-6 shadow-xl text-center">
      <div class="text-4xl mb-3">
       üì¢
      </div>
      <h3 class="text-lg font-bold text-gray-800">Jumlah Bilal</h3>
      <p class="text-3xl font-bold text-green-600" id="totalBilal">0</p>
     </div>
     <div class="card-hover rounded-2xl p-6 shadow-xl text-center">
      <div class="text-4xl mb-3">
       üìã
      </div>
      <h3 class="text-lg font-bold text-gray-800">Jumlah Siak</h3>
      <p class="text-3xl font-bold text-purple-600" id="totalSiak">0</p>
     </div>
    </div><!-- Laporan Terperinci -->
    <div class="card-hover rounded-2xl p-6 shadow-xl">
     <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center"><span class="text-2xl mr-3">üìà</span> Laporan Terperinci</h2>
     <div class="grid md:grid-cols-3 gap-6"><button onclick="generateReport('imam')" class="btn-primary text-white p-6 rounded-xl text-center">
       <div class="text-3xl mb-2">
        üïå
       </div><h3 class="font-bold">Laporan Imam</h3><p class="text-sm opacity-90">Senarai lengkap imam masjid</p></button> <button onclick="generateReport('bilal')" class="btn-success text-white p-6 rounded-xl text-center">
       <div class="text-3xl mb-2">
        üì¢
       </div><h3 class="font-bold">Laporan Bilal</h3><p class="text-sm opacity-90">Senarai lengkap bilal masjid</p></button> <button onclick="generateReport('siak')" class="btn-purple text-white p-6 rounded-xl text-center">
       <div class="text-3xl mb-2">
        üìã
       </div><h3 class="font-bold">Laporan Siak</h3><p class="text-sm opacity-90">Senarai lengkap siak masjid</p></button>
     </div>
    </div>
   </div>
  </main><!-- Modal untuk Edit -->
  <div id="editModal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50">
   <div class="bg-white rounded-2xl p-6 max-w-md w-full mx-4 shadow-2xl">
    <h3 class="text-xl font-bold mb-4" id="modalTitle">Edit Data</h3>
    <div id="modalContent"></div>
    <div class="flex gap-3 mt-6"><button onclick="closeModal()" class="flex-1 btn-secondary text-white py-2 px-4 rounded-lg"> Batal </button> <button onclick="saveEdit()" class="flex-1 btn-primary text-white py-2 px-4 rounded-lg"> Simpan </button>
    </div>
   </div>
  </div><!-- Modal untuk PDF Preview -->
  <div id="pdfPreviewModal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50">
   <div class="bg-white rounded-2xl p-6 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-hidden">
    <div class="flex justify-between items-center mb-4">
     <h3 class="text-xl font-bold" id="pdfPreviewTitle">Pratonton Laporan</h3><button onclick="closePdfPreview()" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
    </div>
    <div id="pdfPreviewContent" class="overflow-y-auto max-h-[60vh] mb-6 border border-gray-200 rounded-lg p-4 bg-gray-50"><!-- Preview content will be inserted here -->
    </div>
    <div class="flex gap-3"><button onclick="closePdfPreview()" class="flex-1 btn-secondary text-white py-2 px-4 rounded-lg"> Tutup </button> <button onclick="confirmPdfDownload()" class="flex-1 btn-primary text-white py-2 px-4 rounded-lg"> üìÑ Muat Turun PDF </button>
    </div>
   </div>
  </div>
  <script>
        // Data storage
        let imamData = [];
        let bilalData = [];
        let siakData = [];
        let currentEditType = '';
        let currentEditIndex = -1;

        // Google Sheets CSV URLs
        const IMAM_SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTMdVbauPNjDdm5PjpJ9757hQAjohDd0rtXxHUfzFOZwbVovFSD6P8x41wsjfzxjw/pub?gid=1151842269&single=true&output=csv';
        const BILAL_SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQ9-yKvr5cPnPV6iTD0RSRph69RGm1J7rwR6dwVaKHR0mG6Eb3wZMXeJu9O4-mgIg/pub?output=csv';

        // Function to calculate age from Malaysian IC number
        function calculateAgeFromIC(nokp) {
            if (!nokp || nokp.length < 6) return '-';
            
            try {
                const yearDigits = nokp.substring(0, 2);
                const month = nokp.substring(2, 4);
                const day = nokp.substring(4, 6);
                
                const year = parseInt(yearDigits) > 30 ? `19${yearDigits}` : `20${yearDigits}`;
                
                const birthDate = new Date(`${year}-${month}-${day}`);
                const today = new Date();
                
                let age = today.getFullYear() - birthDate.getFullYear();
                const monthDiff = today.getMonth() - birthDate.getMonth();
                
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }
                
                return age > 0 && age < 150 ? age : '-';
            } catch (error) {
                return '-';
            }
        }

        // Function to load Imam data from Google Sheets
        async function loadImamDataFromSheet() {
            console.log('üîÑ Memuat data imam dari Google Sheets...');
            showNotification('üîÑ Sedang memuat data imam dari Google Sheets...', 'info');
            
            try {
                const response = await fetch(IMAM_SHEET_URL, {
                    method: 'GET',
                    mode: 'cors',
                    headers: {
                        'Accept': 'text/csv,text/plain,*/*'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const csvText = await response.text();
                console.log('üìÑ CSV data received:', csvText.substring(0, 200) + '...');
                
                const lines = csvText.split('\n').filter(line => line.trim());
                console.log(`üìä Found ${lines.length} lines in CSV`);
                
                imamData = [];
                
                for (let i = 1; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (line) {
                        const values = parseCSVLine(line);
                        console.log(`Row ${i}:`, values);
                        
                        if (values.length >= 8) {
                            const nokp = values[4] || '';
                            const calculatedAge = calculateAgeFromIC(nokp);
                            
                            const imam = {
                                id: Date.now() + i,
                                bil: values[0] || i,
                                masjid: values[1] || '',
                                daerah: values[2] || '',
                                nama: values[3] || '',
                                nokp: nokp,
                                pekerjaan: values[5] || '',
                                alamat: values[6] || '',
                                telefon: values[7] || '',
                                umur: values[8] || calculatedAge,
                                mulaKhidmat: values[9] || new Date().toISOString().split('T')[0],
                                catatan: values[10] || ''
                            };
                            imamData.push(imam);
                        }
                    }
                }
                
                console.log(`‚úÖ Berjaya memuat ${imamData.length} data imam`);
                displayImam();
                updateStatistics();
                updateFilterDropdowns();
                
                if (imamData.length > 0) {
                    showNotification(`‚úÖ Berjaya memuat ${imamData.length} data imam dari Google Sheets`, 'success');
                }
                
            } catch (error) {
                console.error('‚ùå Ralat memuat data imam:', error);
                showNotification(`‚ö†Ô∏è Sambungan Google Sheets gagal: ${error.message}. Sila cuba lagi.`, 'warning');
            }
        }

        // Function to load Bilal data from Google Sheets
        async function loadBilalDataFromSheet() {
            console.log('üîÑ Memuat data bilal dari Google Sheets...');
            showNotification('üîÑ Sedang memuat data bilal dari Google Sheets...', 'info');
            
            try {
                const response = await fetch(BILAL_SHEET_URL, {
                    method: 'GET',
                    mode: 'cors',
                    headers: {
                        'Accept': 'text/csv,text/plain,*/*'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const csvText = await response.text();
                console.log('üìÑ CSV data received:', csvText.substring(0, 200) + '...');
                
                const lines = csvText.split('\n').filter(line => line.trim());
                console.log(`üìä Found ${lines.length} lines in CSV`);
                
                bilalData = [];
                
                for (let i = 1; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (line) {
                        const values = parseCSVLine(line);
                        console.log(`Row ${i}:`, values);
                        
                        if (values.length >= 8) {
                            const nokp = values[4] || '';
                            const calculatedAge = calculateAgeFromIC(nokp);
                            
                            const bilal = {
                                id: Date.now() + i + 1000,
                                bil: values[0] || i,
                                masjid: values[1] || '',
                                daerah: values[2] || '',
                                nama: values[3] || '',
                                nokp: nokp,
                                pekerjaan: values[5] || '',
                                alamat: values[6] || '',
                                telefon: values[7] || '',
                                umur: values[8] || calculatedAge,
                                mulaKhidmat: values[9] || new Date().toISOString().split('T')[0],
                                catatan: values[10] || ''
                            };
                            bilalData.push(bilal);
                        }
                    }
                }
                
                console.log(`‚úÖ Berjaya memuat ${bilalData.length} data bilal`);
                displayBilal();
                updateStatistics();
                updateFilterDropdowns();
                
                if (bilalData.length > 0) {
                    showNotification(`‚úÖ Berjaya memuat ${bilalData.length} data bilal dari Google Sheets`, 'success');
                }
                
            } catch (error) {
                console.error('‚ùå Ralat memuat data bilal:', error);
                showNotification(`‚ö†Ô∏è Sambungan Google Sheets gagal: ${error.message}. Sila cuba lagi.`, 'warning');
            }
        }

        // Function to parse CSV line properly
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim().replace(/"/g, ''));
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(current.trim().replace(/"/g, ''));
            return result;
        }

        // Update date and time
        function updateDateTime() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('ms-MY', options);
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('ms-MY');
        }

        // Tab functionality
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            document.getElementById(tabName + '-tab').classList.remove('hidden');
            
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('btn-primary', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            document.getElementById('tab-' + tabName).classList.remove('bg-gray-200', 'text-gray-700');
            document.getElementById('tab-' + tabName).classList.add('btn-primary', 'text-white');
        }
        
        // Notification function
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 px-6 py-4 rounded-lg shadow-lg text-white font-medium transform transition-all duration-300 translate-x-full`;
            
            switch(type) {
                case 'success':
                    notification.classList.add('bg-green-500');
                    break;
                case 'warning':
                    notification.classList.add('bg-yellow-500');
                    break;
                case 'error':
                    notification.classList.add('bg-red-500');
                    break;
                default:
                    notification.classList.add('bg-blue-500');
            }
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 5000);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            showTab('laporan');
            
            updateDateTime();
            setInterval(updateDateTime, 1000);
            
            // Load data automatically in background
            loadImamDataFromSheet();
            loadBilalDataFromSheet();
            
            displaySiak();
            updateStatistics();
            updateFilterDropdowns();
            
            const mulaKhidmatSiak = document.getElementById('mulaKhidmatSiak');
            if (mulaKhidmatSiak) {
                mulaKhidmatSiak.value = new Date().toISOString().split('T')[0];
            }
            
            // Search functionality
            const searchSiak = document.getElementById('searchSiak');
            const globalSearch = document.getElementById('globalSearch');
            
            if (searchSiak) searchSiak.addEventListener('input', () => searchTable('siak'));
            
            if (globalSearch) {
                globalSearch.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        performGlobalSearch();
                    }
                });
            }
            
            // Form submissions
            const siakForm = document.getElementById('siakForm');
            
            if (siakForm) {
                siakForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const nama = document.getElementById('namaSiak').value.trim();
                    const nokp = document.getElementById('nokpSiak').value.trim();
                    const noGaji = document.getElementById('noGajiSiak').value.trim();
                    const noAkaun = document.getElementById('noAkaunSiak').value.trim();
                    
                    if (!nama || !nokp || !noGaji || !noAkaun) {
                        showNotification('Sila lengkapkan semua maklumat yang diperlukan!', 'warning');
                        return;
                    }
                    
                    const siak = {
                        id: Date.now(),
                        nama: nama,
                        nokp: nokp,
                        noGaji: noGaji,
                        noAkaun: noAkaun,
                        pekerjaan: document.getElementById('pekerjaanSiak').value.trim(),
                        alamat: document.getElementById('alamatSiak').value.trim(),
                        telefon: document.getElementById('telefonSiak').value.trim(),
                        masjid: document.getElementById('masjidSiak').value.trim(),
                        daerah: document.getElementById('daerahSiak').value.trim(),
                        mulaKhidmat: document.getElementById('mulaKhidmatSiak').value
                    };
                    
                    siakData.push(siak);
                    
                    this.reset();
                    document.getElementById('mulaKhidmatSiak').value = new Date().toISOString().split('T')[0];
                    displaySiak();
                    updateStatistics();
                    updateFilterDropdowns();
                    
                    showNotification('‚úÖ Siak berjaya didaftarkan!', 'success');
                });
            }
        });

        // Display imam (without BIL column)
        function displayImam() {
            const tbody = document.getElementById('imamList');
            
            if (imamData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="10" class="text-center py-8 text-gray-500">
                            <div class="text-4xl mb-2">üïå</div>
                            Tiada imam didaftarkan lagi
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = imamData.map((imam, index) => `
                <tr class="table-row border-b hover:bg-blue-50 transition-colors">
                    <td class="py-3 px-4">${imam.masjid}</td>
                    <td class="py-3 px-4">${imam.daerah}</td>
                    <td class="py-3 px-4 font-medium">${imam.nama}</td>
                    <td class="py-3 px-4">${imam.nokp}</td>
                    <td class="py-3 px-4">${imam.pekerjaan}</td>
                    <td class="py-3 px-4">${imam.alamat}</td>
                    <td class="py-3 px-4">${imam.telefon}</td>
                    <td class="py-3 px-4">${imam.umur}</td>
                    <td class="py-3 px-4">${new Date(imam.mulaKhidmat).toLocaleDateString('ms-MY')}</td>
                    <td class="py-3 px-4">${imam.catatan || '-'}</td>
                </tr>
            `).join('');
        }

        // Display bilal (without BIL column)
        function displayBilal() {
            const tbody = document.getElementById('bilalList');
            
            if (bilalData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="10" class="text-center py-8 text-gray-500">
                            <div class="text-4xl mb-2">üì¢</div>
                            Tiada bilal didaftarkan lagi
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = bilalData.map((bilal, index) => `
                <tr class="table-row border-b hover:bg-blue-50 transition-colors">
                    <td class="py-3 px-4">${bilal.masjid}</td>
                    <td class="py-3 px-4">${bilal.daerah}</td>
                    <td class="py-3 px-4 font-medium">${bilal.nama}</td>
                    <td class="py-3 px-4">${bilal.nokp}</td>
                    <td class="py-3 px-4">${bilal.pekerjaan}</td>
                    <td class="py-3 px-4">${bilal.alamat}</td>
                    <td class="py-3 px-4">${bilal.telefon}</td>
                    <td class="py-3 px-4">${bilal.umur}</td>
                    <td class="py-3 px-4">${new Date(bilal.mulaKhidmat).toLocaleDateString('ms-MY')}</td>
                    <td class="py-3 px-4">${bilal.catatan || '-'}</td>
                </tr>
            `).join('');
        }

        // Display siak
        function displaySiak() {
            const tbody = document.getElementById('siakList');
            
            if (siakData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="12" class="text-center py-8 text-gray-500">
                            <div class="text-4xl mb-2">üìã</div>
                            Tiada siak didaftarkan lagi
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = siakData.map((siak, index) => `
                <tr class="table-row border-b hover:bg-blue-50 transition-colors">
                    <td class="py-3 px-4">${index + 1}</td>
                    <td class="py-3 px-4 font-medium">${siak.nama}</td>
                    <td class="py-3 px-4">${siak.nokp}</td>
                    <td class="py-3 px-4">${siak.noGaji}</td>
                    <td class="py-3 px-4">${siak.noAkaun}</td>
                    <td class="py-3 px-4">${siak.pekerjaan}</td>
                    <td class="py-3 px-4">${siak.alamat}</td>
                    <td class="py-3 px-4">${siak.telefon}</td>
                    <td class="py-3 px-4">${siak.masjid}</td>
                    <td class="py-3 px-4">${siak.daerah}</td>
                    <td class="py-3 px-4">${new Date(siak.mulaKhidmat).toLocaleDateString('ms-MY')}</td>
                    <td class="py-3 px-4">
                        <div class="flex gap-2">
                            <button onclick="editItem('siak', ${index})" class="text-blue-600 hover:text-blue-800 text-sm">
                                ‚úèÔ∏è Edit
                            </button>
                            <button onclick="deleteItem('siak', ${index})" class="text-red-600 hover:text-red-800 text-sm">
                                üóëÔ∏è Hapus
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Update statistics
        function updateStatistics() {
            document.getElementById('totalImam').textContent = imamData.length;
            document.getElementById('totalBilal').textContent = bilalData.length;
            document.getElementById('totalSiak').textContent = siakData.length;
        }

        // Update filter dropdowns
        function updateFilterDropdowns() {
            const allData = [...imamData, ...bilalData, ...siakData];
            
            // Update Masjid filter
            const masjidSet = new Set();
            allData.forEach(item => {
                if (item.masjid) masjidSet.add(item.masjid);
            });
            
            const filterMasjid = document.getElementById('filterMasjid');
            if (filterMasjid) {
                filterMasjid.innerHTML = '<option value="">Semua Masjid</option>';
                Array.from(masjidSet).sort().forEach(masjid => {
                    filterMasjid.innerHTML += `<option value="${masjid}">${masjid}</option>`;
                });
            }
        }

        // Search functionality
        function searchTable(type) {
            const searchTerm = document.getElementById(`search${type.charAt(0).toUpperCase() + type.slice(1)}`).value.toLowerCase();
            const rows = document.querySelectorAll(`#${type}List tr`);
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        // Edit functionality
        function editItem(type, index) {
            currentEditType = type;
            currentEditIndex = index;
            
            const data = siakData[index];
            
            let modalContent = `
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Nama Siak</label>
                        <input type="text" id="editNama" value="${data.nama}" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">No. K/P</label>
                        <input type="text" id="editNokp" value="${data.nokp}" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">No. Gaji</label>
                        <input type="text" id="editNoGaji" value="${data.noGaji}" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">No. Akaun BSN</label>
                        <input type="text" id="editNoAkaun" value="${data.noAkaun}" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Pekerjaan</label>
                        <input type="text" id="editPekerjaan" value="${data.pekerjaan}" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Alamat</label>
                        <textarea id="editAlamat" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg">${data.alamat}</textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">No. Tel</label>
                        <input type="tel" id="editTelefon" value="${data.telefon}" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Masjid</label>
                        <input type="text" id="editMasjid" value="${data.masjid}" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Daerah</label>
                        <input type="text" id="editDaerah" value="${data.daerah}" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Mula Khidmat</label>
                        <input type="date" id="editMulaKhidmat" value="${data.mulaKhidmat}" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                    </div>
                </div>
            `;
            
            document.getElementById('modalTitle').textContent = `Edit ${type.charAt(0).toUpperCase() + type.slice(1)}`;
            document.getElementById('modalContent').innerHTML = modalContent;
            document.getElementById('editModal').classList.remove('hidden');
            document.getElementById('editModal').classList.add('flex');
        }

        // Save edit
        function saveEdit() {
            siakData[currentEditIndex] = {
                ...siakData[currentEditIndex],
                nama: document.getElementById('editNama').value,
                nokp: document.getElementById('editNokp').value,
                noGaji: document.getElementById('editNoGaji').value,
                noAkaun: document.getElementById('editNoAkaun').value,
                pekerjaan: document.getElementById('editPekerjaan').value,
                alamat: document.getElementById('editAlamat').value,
                telefon: document.getElementById('editTelefon').value,
                masjid: document.getElementById('editMasjid').value,
                daerah: document.getElementById('editDaerah').value,
                mulaKhidmat: document.getElementById('editMulaKhidmat').value
            };
            
            displaySiak();
            updateStatistics();
            updateFilterDropdowns();
            closeModal();
            showNotification('‚úÖ Data berjaya dikemaskini!', 'success');
        }

        // Close modal
        function closeModal() {
            document.getElementById('editModal').classList.add('hidden');
            document.getElementById('editModal').classList.remove('flex');
        }

        // Delete item
        function deleteItem(type, index) {
            const confirmDelete = document.createElement('div');
            confirmDelete.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            confirmDelete.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-sm mx-4">
                    <h3 class="text-lg font-bold mb-4">Pengesahan Hapus</h3>
                    <p class="text-gray-600 mb-6">Adakah anda pasti ingin menghapus data ini?</p>
                    <div class="flex gap-3">
                        <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400">
                            Batal
                        </button>
                        <button onclick="confirmDeleteAction(${index}); this.closest('.fixed').remove()" class="flex-1 bg-red-500 text-white py-2 px-4 rounded-lg hover:bg-red-600">
                            Hapus
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(confirmDelete);
        }
        
        function confirmDeleteAction(index) {
            siakData.splice(index, 1);
            displaySiak();
            updateStatistics();
            updateFilterDropdowns();
            showNotification('‚úÖ Data berjaya dihapus!', 'success');
        }

        // Clear all data
        function clearAllData(type) {
            const confirmClear = document.createElement('div');
            confirmClear.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            confirmClear.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-sm mx-4">
                    <h3 class="text-lg font-bold mb-4">Pengesahan Kosongkan</h3>
                    <p class="text-gray-600 mb-6">Adakah anda pasti ingin mengosongkan semua data ${type}? Tindakan ini tidak boleh dibatalkan.</p>
                    <div class="flex gap-3">
                        <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400">
                            Batal
                        </button>
                        <button onclick="confirmClearAction(); this.closest('.fixed').remove()" class="flex-1 bg-red-500 text-white py-2 px-4 rounded-lg hover:bg-red-600">
                            Kosongkan
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(confirmClear);
        }
        
        function confirmClearAction() {
            siakData = [];
            displaySiak();
            updateStatistics();
            updateFilterDropdowns();
            showNotification('‚úÖ Semua data telah dikosongkan!', 'success');
        }

        // PDF Preview and Export functionality
        let currentPdfData = null;
        let currentPdfType = '';

        function exportToPDF(type) {
            currentPdfType = type;
            showPdfPreview(type);
        }

        function showPdfPreview(type) {
            let tableData = [];
            let headers = [];
            let title = '';
            
            if (type === 'imam') {
                title = 'Laporan Imam';
                headers = ['Masjid', 'Daerah', 'Nama Imam', 'No. K/P', 'Pekerjaan', 'Alamat', 'No. Tel', 'Umur', 'Mula Khidmat', 'Catatan'];
                tableData = imamData.map((imam, index) => [
                    imam.masjid,
                    imam.daerah,
                    imam.nama,
                    imam.nokp,
                    imam.pekerjaan,
                    imam.alamat,
                    imam.telefon,
                    imam.umur,
                    new Date(imam.mulaKhidmat).toLocaleDateString('ms-MY'),
                    imam.catatan || '-'
                ]);
            } else if (type === 'bilal') {
                title = 'Laporan Bilal';
                headers = ['Masjid', 'Daerah', 'Nama Bilal', 'No. K/P', 'Pekerjaan', 'Alamat', 'No. Tel', 'Umur', 'Mula Khidmat', 'Catatan'];
                tableData = bilalData.map((bilal, index) => [
                    bilal.masjid,
                    bilal.daerah,
                    bilal.nama,
                    bilal.nokp,
                    bilal.pekerjaan,
                    bilal.alamat,
                    bilal.telefon,
                    bilal.umur,
                    new Date(bilal.mulaKhidmat).toLocaleDateString('ms-MY'),
                    bilal.catatan || '-'
                ]);
            } else {
                title = 'Laporan Siak';
                headers = ['Bil', 'Nama Siak', 'No. K/P', 'No. Gaji', 'No. Akaun BSN', 'Pekerjaan', 'Alamat', 'No. Tel', 'Mula Khidmat'];
                tableData = siakData.map((siak, index) => [
                    index + 1,
                    siak.nama,
                    siak.nokp,
                    siak.noGaji,
                    siak.noAkaun,
                    siak.pekerjaan,
                    siak.alamat,
                    siak.telefon,
                    new Date(siak.mulaKhidmat).toLocaleDateString('ms-MY')
                ]);
            }

            currentPdfData = { headers, tableData, title, type };

            // Generate preview HTML
            const previewHtml = `
                <div class="text-center mb-4">
                    <h2 class="text-xl font-bold">${title}</h2>
                    <p class="text-gray-600">Tarikh: ${new Date().toLocaleDateString('ms-MY')}</p>
                    <p class="text-gray-600">Jumlah Rekod: ${tableData.length}</p>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse border border-gray-300 text-sm">
                        <thead>
                            <tr class="bg-gray-100">
                                ${headers.map(header => `<th class="border border-gray-300 px-2 py-1 text-left font-semibold">${header}</th>`).join('')}
                            </tr>
                        </thead>
                        <tbody>
                            ${tableData.map(row => `
                                <tr class="hover:bg-gray-50">
                                    ${row.map(cell => `<td class="border border-gray-300 px-2 py-1">${cell}</td>`).join('')}
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;

            document.getElementById('pdfPreviewTitle').textContent = `Pratonton ${title}`;
            document.getElementById('pdfPreviewContent').innerHTML = previewHtml;
            document.getElementById('pdfPreviewModal').classList.remove('hidden');
            document.getElementById('pdfPreviewModal').classList.add('flex');
        }

        function closePdfPreview() {
            document.getElementById('pdfPreviewModal').classList.add('hidden');
            document.getElementById('pdfPreviewModal').classList.remove('flex');
            currentPdfData = null;
            currentPdfType = '';
        }

        function confirmPdfDownload() {
            if (!currentPdfData) return;

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('landscape');
            
            doc.setFontSize(20);
            doc.text(currentPdfData.title, 20, 20);
            
            if (currentPdfData.type === 'hasil-carian') {
                doc.setFontSize(14);
                doc.text(`Kata Kunci Carian: "${currentPdfData.searchTerm}"`, 20, 35);
                
                doc.setFontSize(12);
                doc.text(`Tarikh: ${new Date().toLocaleDateString('ms-MY')}`, 20, 45);
                doc.text(`Masa: ${new Date().toLocaleTimeString('ms-MY')}`, 20, 55);
                doc.text(`Jumlah Keputusan: ${currentPdfData.tableData.length} rekod`, 20, 65);
                
                doc.autoTable({
                    head: [currentPdfData.headers],
                    body: currentPdfData.tableData,
                    startY: 75,
                    styles: {
                        fontSize: 9,
                        cellPadding: 2
                    },
                    headStyles: {
                        fillColor: [30, 41, 59],
                        textColor: 255,
                        fontSize: 10,
                        fontStyle: 'bold'
                    }
                });
                
                doc.save(`hasil-carian-${currentPdfData.searchTerm.replace(/\s+/g, '-')}-${new Date().toISOString().split('T')[0]}.pdf`);
                showNotification('‚úÖ Laporan hasil carian berjaya dimuat turun!', 'success');
            } else {
                doc.setFontSize(12);
                doc.text(`Tarikh: ${new Date().toLocaleDateString('ms-MY')}`, 20, 35);
                
                doc.autoTable({
                    head: [currentPdfData.headers],
                    body: currentPdfData.tableData,
                    startY: 45,
                    styles: {
                        fontSize: 10,
                        cellPadding: 3
                    },
                    headStyles: {
                        fillColor: [30, 41, 59],
                        textColor: 255
                    }
                });
                
                doc.save(`laporan-${currentPdfData.type}-${new Date().toISOString().split('T')[0]}.pdf`);
                showNotification(`‚úÖ Laporan ${currentPdfData.type} berjaya dimuat turun!`, 'success');
            }
            
            closePdfPreview();
        }

        // Generate report
        function generateReport(type) {
            exportToPDF(type);
        }

        // Global search functionality
        let currentSearchResults = [];
        let currentSearchTerm = '';

        function performGlobalSearch() {
            const searchTerm = document.getElementById('globalSearch').value.toLowerCase().trim();
            const filterMasjid = document.getElementById('filterMasjid').value;
            const filterJawatan = document.getElementById('filterJawatan').value;
            
            const results = [];
            
            // Search in Imam data
            if (!filterJawatan || filterJawatan === 'imam') {
                imamData.forEach((imam, index) => {
                    const matchesSearch = !searchTerm || imam.nama.toLowerCase().includes(searchTerm) || imam.nokp.includes(searchTerm);
                    const matchesMasjid = !filterMasjid || imam.masjid === filterMasjid;
                    
                    if (matchesSearch && matchesMasjid) {
                        results.push({
                            type: 'Imam',
                            data: imam,
                            index: index,
                            icon: 'üïå'
                        });
                    }
                });
            }
            
            // Search in Bilal data
            if (!filterJawatan || filterJawatan === 'bilal') {
                bilalData.forEach((bilal, index) => {
                    const matchesSearch = !searchTerm || bilal.nama.toLowerCase().includes(searchTerm) || bilal.nokp.includes(searchTerm);
                    const matchesMasjid = !filterMasjid || bilal.masjid === filterMasjid;
                    
                    if (matchesSearch && matchesMasjid) {
                        results.push({
                            type: 'Bilal',
                            data: bilal,
                            index: index,
                            icon: 'üì¢'
                        });
                    }
                });
            }
            
            // Search in Siak data
            if (!filterJawatan || filterJawatan === 'siak') {
                siakData.forEach((siak, index) => {
                    const matchesSearch = !searchTerm || siak.nama.toLowerCase().includes(searchTerm) || siak.nokp.includes(searchTerm);
                    const matchesMasjid = !filterMasjid || siak.masjid === filterMasjid;
                    
                    if (matchesSearch && matchesMasjid) {
                        results.push({
                            type: 'Siak',
                            data: siak,
                            index: index,
                            icon: 'üìã'
                        });
                    }
                });
            }
            
            displayGlobalSearchResults(results, searchTerm || 'filter');
        }

        function displayGlobalSearchResults(results, searchTerm) {
            const resultsContainer = document.getElementById('globalSearchResults');
            const resultsContent = document.getElementById('searchResultsContent');
            const exportBtn = document.getElementById('exportSearchBtn');
            
            currentSearchResults = results;
            currentSearchTerm = searchTerm;
            
            if (results.length === 0) {
                resultsContent.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <div class="text-4xl mb-2">üîç</div>
                        <p>Tiada keputusan ditemui untuk carian ini</p>
                        <p class="text-sm mt-2">Cuba ubah kriteria carian anda</p>
                    </div>
                `;
                exportBtn.classList.add('hidden');
            } else {
                resultsContent.innerHTML = results.map(result => `
                    <div class="bg-white border border-gray-200 rounded-xl p-4 shadow-sm hover:shadow-md transition-shadow">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <div class="flex items-center mb-2">
                                    <span class="text-2xl mr-2">${result.icon}</span>
                                    <span class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded-full">${result.type}</span>
                                </div>
                                <h4 class="text-lg font-semibold text-gray-800 mb-1">${result.data.nama}</h4>
                                <div class="grid grid-cols-2 gap-4 text-sm text-gray-600">
                                    <div><strong>Masjid:</strong> ${result.data.masjid}</div>
                                    <div><strong>Daerah:</strong> ${result.data.daerah}</div>
                                    <div><strong>No. K/P:</strong> ${result.data.nokp}</div>
                                    <div><strong>Pekerjaan:</strong> ${result.data.pekerjaan}</div>
                                    <div class="col-span-2"><strong>Alamat:</strong> ${result.data.alamat}</div>
                                    <div><strong>No. Tel:</strong> ${result.data.telefon}</div>
                                    <div><strong>Umur:</strong> ${result.data.umur || '-'}</div>
                                    <div><strong>Mula Khidmat:</strong> ${new Date(result.data.mulaKhidmat).toLocaleDateString('ms-MY')}</div>
                                    <div class="col-span-2"><strong>Catatan:</strong> ${result.data.catatan || '-'}</div>
                                </div>
                            </div>
                            <div class="flex flex-col gap-2 ml-4">
                                ${result.type === 'Siak' ? `<button onclick="editItem('${result.type.toLowerCase()}', ${result.index})" class="text-blue-600 hover:text-blue-800 text-sm px-3 py-1 border border-blue-300 rounded-lg hover:bg-blue-50 transition-colors">‚úèÔ∏è Edit</button>` : ''}
                                <button onclick="goToTab('${result.type.toLowerCase()}')" class="text-green-600 hover:text-green-800 text-sm px-3 py-1 border border-green-300 rounded-lg hover:bg-green-50 transition-colors">
                                    üëÅÔ∏è Lihat
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
                exportBtn.classList.remove('hidden');
            }
            
            resultsContainer.classList.remove('hidden');
            resultsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Export search results to PDF with preview
        function exportSearchResultsToPDF() {
            if (currentSearchResults.length === 0) {
                showNotification('Tiada hasil carian untuk dicetak!', 'warning');
                return;
            }

            const title = 'Laporan Hasil Carian Pegawai Masjid';
            const headers = ['Bil', 'Jenis', 'Nama', 'No. K/P', 'Pekerjaan', 'Masjid', 'Daerah', 'No. Tel', 'Umur', 'Mula Khidmat'];
            const tableData = currentSearchResults.map((result, index) => [
                index + 1,
                result.type,
                result.data.nama,
                result.data.nokp,
                result.data.pekerjaan,
                result.data.masjid,
                result.data.daerah,
                result.data.telefon,
                result.data.umur || '-',
                new Date(result.data.mulaKhidmat).toLocaleDateString('ms-MY')
            ]);

            currentPdfData = { 
                headers, 
                tableData, 
                title, 
                type: 'hasil-carian',
                searchTerm: currentSearchTerm
            };

            // Generate preview HTML for search results
            const previewHtml = `
                <div class="text-center mb-4">
                    <h2 class="text-xl font-bold">${title}</h2>
                    <p class="text-gray-600">Kata Kunci Carian: "${currentSearchTerm}"</p>
                    <p class="text-gray-600">Tarikh: ${new Date().toLocaleDateString('ms-MY')}</p>
                    <p class="text-gray-600">Masa: ${new Date().toLocaleTimeString('ms-MY')}</p>
                    <p class="text-gray-600">Jumlah Keputusan: ${tableData.length} rekod</p>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse border border-gray-300 text-sm">
                        <thead>
                            <tr class="bg-gray-100">
                                ${headers.map(header => `<th class="border border-gray-300 px-2 py-1 text-left font-semibold">${header}</th>`).join('')}
                            </tr>
                        </thead>
                        <tbody>
                            ${tableData.map(row => `
                                <tr class="hover:bg-gray-50">
                                    ${row.map(cell => `<td class="border border-gray-300 px-2 py-1">${cell}</td>`).join('')}
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;

            document.getElementById('pdfPreviewTitle').textContent = `Pratonton ${title}`;
            document.getElementById('pdfPreviewContent').innerHTML = previewHtml;
            document.getElementById('pdfPreviewModal').classList.remove('hidden');
            document.getElementById('pdfPreviewModal').classList.add('flex');
        }
        
        function clearGlobalSearch() {
            document.getElementById('globalSearch').value = '';
            document.getElementById('filterMasjid').value = '';
            document.getElementById('filterJawatan').value = '';
            document.getElementById('globalSearchResults').classList.add('hidden');
            document.getElementById('exportSearchBtn').classList.add('hidden');
            currentSearchResults = [];
            currentSearchTerm = '';
        }
        
        function goToTab(type) {
            showTab(type);
            document.getElementById(type + '-tab').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Toggle functions for forms and lists        
        function toggleImamList() {
            const listSection = document.getElementById('imamListSection');
            const listBtn = document.getElementById('toggleImamListBtn');
            
            if (listSection.classList.contains('hidden')) {
                listSection.classList.remove('hidden');
                listBtn.classList.remove('btn-secondary');
                listBtn.classList.add('btn-primary');
                listBtn.innerHTML = '‚ùå Tutup Senarai';
            } else {
                listSection.classList.add('hidden');
                listBtn.classList.remove('btn-primary');
                listBtn.classList.add('btn-secondary');
                listBtn.innerHTML = 'üìã Lihat Senarai Imam';
            }
        }
        
        function toggleBilalList() {
            const listSection = document.getElementById('bilalListSection');
            const listBtn = document.getElementById('toggleBilalListBtn');
            
            if (listSection.classList.contains('hidden')) {
                listSection.classList.remove('hidden');
                listBtn.classList.remove('btn-secondary');
                listBtn.classList.add('btn-primary');
                listBtn.innerHTML = '‚ùå Tutup Senarai';
            } else {
                listSection.classList.add('hidden');
                listBtn.classList.remove('btn-primary');
                listBtn.classList.add('btn-secondary');
                listBtn.innerHTML = 'üìã Lihat Senarai Bilal';
            }
        }
        
        function toggleSiakForm() {
            const formSection = document.getElementById('siakFormSection');
            const listSection = document.getElementById('siakListSection');
            const formBtn = document.getElementById('toggleSiakFormBtn');
            const listBtn = document.getElementById('toggleSiakListBtn');
            
            if (formSection.classList.contains('hidden')) {
                formSection.classList.remove('hidden');
                listSection.classList.add('hidden');
                formBtn.classList.remove('btn-purple');
                formBtn.classList.add('btn-secondary');
                formBtn.innerHTML = '‚ùå Tutup Borang';
                listBtn.classList.remove('btn-secondary');
                listBtn.classList.add('btn-purple');
                listBtn.innerHTML = 'üìã Lihat Senarai Siak';
            } else {
                formSection.classList.add('hidden');
                formBtn.classList.remove('btn-secondary');
                formBtn.classList.add('btn-purple');
                formBtn.innerHTML = '‚ûï Daftar Siak Baru';
            }
        }
        
        function toggleSiakList() {
            const formSection = document.getElementById('siakFormSection');
            const listSection = document.getElementById('siakListSection');
            const formBtn = document.getElementById('toggleSiakFormBtn');
            const listBtn = document.getElementById('toggleSiakListBtn');
            
            if (listSection.classList.contains('hidden')) {
                listSection.classList.remove('hidden');
                formSection.classList.add('hidden');
                listBtn.classList.remove('btn-secondary');
                listBtn.classList.add('btn-purple');
                listBtn.innerHTML = '‚ùå Tutup Senarai';
                formBtn.classList.remove('btn-secondary');
                formBtn.classList.add('btn-purple');
                formBtn.innerHTML = '‚ûï Daftar Siak Baru';
            } else {
                listSection.classList.add('hidden');
                listBtn.classList.remove('btn-purple');
                listBtn.classList.add('btn-secondary');
                listBtn.innerHTML = 'üìã Lihat Senarai Siak';
            }
        }

        // Close modal when clicking outside
        document.getElementById('editModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
    </script> 
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98f4e06dc5c71685',t:'MTc2MDU4OTYxMS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>